!function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);throw new Error("Cannot find module '"+o+"'")}var c=r[o]={exports:{}};t[o][0].call(c.exports,function(e){var r=t[o][1][e];return i(r?r:e)},c,c.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";var n=e("./PackagePool"),i=e("./LinkManager"),a=e("./Parser"),o=e("./utils"),s=e("./Grid"),l=(o.Obj,o.Arr),c=[],u=0,f={is:"formula",free:"free",fake:"fake"},h=function e(t){var r=Object.keys(t.cell_types),n=Object.keys(t.cell_values),i=l.unique(r.concat(n)),s=[],c=!0,u=!1,h=void 0;try{for(var p,d=i[Symbol.iterator]();!(c=(p=d.next()).done);c=!0){var v=p.value,_=void 0,y=void 0;t.cell_types[v]?(_=o.split_camelcase(t.cell_types[v].type),y=t.cell_types[v].type):(_=["free"],y="free");var m={},g=!1,b=!0,k=!1,x=void 0;try{for(var w,$=_[Symbol.iterator]();!(b=(w=$.next()).done);b=!0){var S=w.value;a.system_macros.has(S)&&"is"!==S&&(m[S]=!0,g=!0)}}catch(e){k=!0,x=e}finally{try{!b&&$.return&&$.return()}finally{if(k)throw x}}g&&(y="is"),f[y]||console.log("unmapped type!",y),y=f[y];var O=t.cell_parents(v),A={},F=!0,C=!1,j=void 0;try{for(var E,L=O[Symbol.iterator]();!(F=(E=L.next()).done);F=!0){var N=E.value;t.cellExists(N)||(A[N]=!0)}}catch(e){C=!0,j=e}finally{try{!F&&L.return&&L.return()}finally{if(C)throw j}}var T={name:v,val:t.cell_values[v],parents:O,wrong_links:A,type:y,props:m};g&&(T.subtype=t.cell_types[v].type),s.push(T)}}catch(e){u=!0,h=e}finally{try{!c&&d.return&&d.return()}finally{if(u)throw h}}var P=o.group_by(s,function(e){return e.name.indexOf("/")!==-1?"linked":0===e.name.indexOf("$child")||"$all_children"===e.name?"children":e.name.indexOf("|")!==-1?"DOM":"$"===e.name[0]?"system":e.props.funnel?"funnel":e.type}),G=t.linked_grids_provider.pool,M={};for(var I in G)if(".."!==I){var q=G[I],z=t.app.getGrid(q);M[I]=e(z)}for(var V in P)P[V].sort(function(e,t){return e.name>t.name?1:-1});return{children:M,cells:P}},p=function(e){return h(e.root)},d=function(e,t){if(this.id=++u,this.grid_create_counter=0,this.packagePool=new n(t,this.id),e){var r=!0,a=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;this.packagePool.load(c)}}catch(e){a=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw o}}}this.grids={},this.gridIds=0,this.linkManager=new i(this)};d.prototype.onChangeFinished=function(e){this.onChangeFinishedStack||(this.onChangeFinishedStack=[]),this.onChangeFinishedStack.push(e)},d.prototype._changeFinished=function(){if(this.onChangeFinishedStack){var e=!0,t=!1,r=void 0;try{for(var n,i=this.onChangeFinishedStack[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var a=n.value;a()}}catch(e){t=!0,r=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw r}}}},d.prototype.get=function(e,t){return t&&"/"===t[0]&&(t=t.substr(1)),this.root.get(e,t)},d.prototype.getStruct=function(){return p(this)},d.prototype.getVals=function(){return get_vals(this.root)},d.prototype.getGrid=function(e){return this.grids[e]},d.prototype.set=function(e,t,r){this.root.set(e,t,r)},d.prototype.eachChild=function(e,t){var r=this.getGrid(e);for(var n in r.linked_grids){var i=this.getGrid(r.linked_grids[n]);t(i),this.eachChild(r.linked_grids[n],t)}},d.prototype.eachParent=function(e,t){for(;e;){var r=this.getGrid(e);t(r),e=r.parent}};var v={cell_parents:function(e){return this.cell_types[e]?this.cell_types[e].parents:[]},cell_children:function(e){return this.cell_types[e]?this.cell_types[e].children:{}},setLevels:function(){this.levels={};var e=new Set,t=[];for(var r in this.cell_types)if(0===this.cell_types[r].parents.length){this.levels[r]=1;for(var n in this.cell_types[r].children)t.push(n),this.setLevelsRec(n,e)}for(var i=0;t[i];)this.setLevelsIterable(t[i],t),i++},setLevelsIterable:function(e,t){var r=1,n=!0,i=!1,o=void 0;try{for(var s,l=this.cell_parents(e)[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;c=a.real_cell_name(c),void 0===this.levels[c]&&t.indexOf(c)===-1&&this.setLevelsIterable(c,t),this.levels[c]>r&&(r=this.levels[c])}}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}if(this.levels[e])return void(r+1>this.levels[e]&&(this.levels[e]=r+1));this.levels[e]=r+1;for(var c in this.cell_children(e))t.indexOf(c)===-1&&t.push(c)},setLevelsRec:function(e,t){var r=1,n=!0,i=!1,o=void 0;try{for(var s,l=this.cell_parents(e)[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;c=a.real_cell_name(c),void 0===this.levels[c],this.levels[c]>r&&(r=this.levels[c])}}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}if(this.levels[e]){r+1>this.levels[e]&&(this.levels[e]=r+1);for(var c in this.cell_children(e))this.levels[c]<=this.levels[e]&&(t.add(c),this.setLevelsRec(c,t))}else{this.levels[e]=r+1;for(var c in this.cell_children(e))t.has(c)||(t.add(c),this.setLevelsRec(c,t))}}};d.prototype.parse_cbs=function(e){var t=Object.assign({},this.packagePool.eachGridMixin),r=Object.create(v);return r.plain_base=Object.assign(t,e),r.side_effects={},r.grids_to_link={},r.no_args_cells={},a.parse_pb(r,this.packagePool),o.init_if_empty(r.plain_base,"$init",{},"$name",null),r.cell_types=a.parse_cell_types(r.plain_base),r.setLevels(),r},d.prototype.loadPackage=function(e){this.packagePool.load(e)},d.prototype.setGrid=function(e,t){this.grids[e]=t},d.prototype.branchCreated=function(e){var t=this.getGrid(e),r=t.path;if(Firera.onBranchCreatedStack[this.id]){var n=!0,i=!1,a=void 0;try{for(var o,s=Firera.onBranchCreatedStack[this.id][Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;l(this,e,r,t.parent)}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}}},d.prototype.createGrid=function(e,t,r,n){var i=this.getGrid(n);r=i.init_values[t]?Object.assign({},i.init_values[t],r||{}):r;var a=i.path,o=("/"!==a?a+"/":"/")+t,l=new s(this,e,t,r,!0,n,o);return Firera.gridCreated(this,l.id,l.path,l.parent),l.id},d.apps=c,d.get_app_struct=p,t.exports=d},{"./Grid":2,"./LinkManager":3,"./PackagePool":4,"./Parser":5,"./utils":13}],2:[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var i=e("./Parser"),a=e("./utils"),o=a.Obj,s=(a.Arr,function(e){return!e.match(/^([a-zA-Z0-9\_]*)$/)}),l=function(e,t){return{pool:{},create:function(t,r,n,i){var o=t.app.createGrid(r,n,i,t.id);return a.init_if_empty(t,"linked_grids",{},n,o),this.set(n,o),this.get(n).linked_grids_provider.set("..",t.id),e.linkManager.onNewGridAdded(t.id,o),o},set:function(e,t){this.pool[e]=t},isLinked:function(e){return!!this.get(e)},get:function(t){var r=this.pool[t];return!!r&&e.grids[r]},eachChild:function(e){for(var t in this.pool)".."!==t&&e(this.pool[t],t)},remove:function(e){var r=this.pool[e];delete this.pool[e],t.app.grids[r].set("$remove",!0),delete t.app.grids[r]},setCellValues:function(e,t,r){this.get(e).set(t,!1,!1,!1,r)},initChild:function(e){this.get(e).init||console.log("strange",this,e),this.get(e).init()},unlinkChildCells:function(e){var t=this.get(e);t&&this.remove(e)},getLinkedGridCellValue:function(e,t){var r=this.get(e);return!!r&&r.cell_value(t)},linkAnyTwoCells:function(r,n){r.indexOf("/")!==-1?e.linkManager.initLink(t.id,r):c(t.dynamic_cell_links,r,"__self",n,"dynamic")}}},c=function(e,t,r,n,i){a.init_if_empty(e,t,{},r,[]);var o=e[t][r],s=!0,l=!1,c=void 0;try{for(var u,f=o[Symbol.iterator]();!(s=(u=f.next()).done);s=!0){var h=u.value;if(h.cell_name===n&&h.type===i)return}}catch(e){l=!0,c=e}finally{try{!s&&f.return&&f.return()}finally{if(l)throw c}}o.push({cell_name:n,type:i})},u=function(e,t,r,n,i,a,s){var c=this,u=this,f=++e.gridIds;this.path=s,e.setGrid(f,this),this.id=f,this.parent=a,this.app=e,this.name=r||"$root";var h;if(this.parsed_pb_name=t,"string"==typeof t)h=e.cbs[t];else{var p="$$$_@@@_tag";t[p]?h=t[p]:(h=e.parse_cbs(t),t[p]=h)}if(!h)return void console.error("Cannot find grid to parse:",t);if(this.cell_types=h.cell_types,this.side_effects=h.side_effects,this.grids_to_link=h.grids_to_link,this.plain_base=Object.create(h.plain_base),this.link_chains=Object.create(h.link_chains||{}),this.levels=Object.create(h.levels),this.linked_grids_provider=l(e,u),this.linked_grids={},this.cell_funcs={},this.dirtyCounter={},this.dynamic_cell_links={},this.dynamic_cells_props={},this.cell_values=Object.assign({},this.plain_base.$init||{}),this.init_values=Object.assign({},this.plain_base.$init,n||{}),this.asterisk_omit_list=this.all_cell_children("*"),o.each(this.grids_to_link,function(e,t){return c.linkChild(e,t)}),this.plain_base.$init&&!i&&this.init(),h.no_args_cells){Number.POSITIVE_INFINITY;this.updateTree(h.no_args_cells,!1,!0)}if(this.link_chains)for(var d in this.link_chains)this.initLinkChain(d)};u.prototype.changesFinished=function(){this.app._changeFinished()},u.prototype.initIfSideEffectCell=function(e){if(!this.cellExists(e)&&s(e)){i.parse_cellname(e,this,"getter",this.app.packagePool,this),this.cell_types=i.parse_cell_types(this.plain_base);var t=i.findMatcher(e,this.app.packagePool);if(t&&this.compute(e),this.cell_types[e]){var r=0,n=!0,a=!1,o=void 0;try{for(var l,c=this.cell_types[e].parents[Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var u=l.value;this.levels[u]>r&&(r=this.levels[u])}}catch(e){a=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}this.levels[e]=r+1}}},u.prototype.hasChild=function(e){return this.linked_grids&&this.linked_grids[e]},u.prototype.init=function(){for(var e in this.init_values)i.parse_cellname(e,this,"setter",this.app.packagePool);this.set(this.init_values)},u.prototype.updateChildFreeValues=function(e,t,r){this.linked_grids_provider.setCellValues(e,t,r)},u.prototype.initLinkChain=function(e){this.app.linkManager.initLink(this.id,e)},u.prototype.linkGrid=function(e,t){var r=this;++this.app.grid_create_counter;var n,i,a,s;if(e=e.replace("$child_",""),t instanceof Array?(n=t[0],i=t[1],a=t[2],s=t[3]||{}):n=t,!n)return void console.warn("Trying to link undefined grid:",n);var l=this.linkChild(n,e,s);i&&o.each(i,function(t,n){r.app.linkManager.initLink(r.id,e+"/"+t,n)}),a&&o.each(a,function(e,t){r.app.linkManager.initLink(l,"../"+e,t)}),--this.app.grid_create_counter,0===this.app.grid_create_counter&&this.app.branchCreated(l)},u.prototype.getChild=function(e){return this.app.getGrid(this.linked_grids_provider.pool[e])},u.prototype.linkChild=function(e,t,r){if(this.linked_grids_provider.isLinked(t)){var n=this.getChild(t).parsed_pb_name;if(n===e)return this.getChild(t).set(r),this.linked_grids_provider.pool[t];this.unlinkChild(t)}var i=this.linked_grids_provider.create(this,e,t,r);return this.linked_grids_provider.initChild(t),i},u.prototype.unlinkChild=function(e){this.linked_grids_provider.unlinkChildCells(e)},u.prototype.getChildrenValues=function(){var e=this,t=[];return this.linked_grids_provider.eachChild(function(r,n){t[n]=e.app.getGrid(r).cell_values}),t},u.prototype.doRecursive=function(e,t,r,n){var i=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=arguments[5];this.doRecursive.bind(this,e);r||(e(t,n),a[t]=!0),this.cell_has_type(t,"async")&&!s||o.eachKey(this.cell_children(t),function(r){a[r]||(a[r]=!0,i.doRecursive(e,r,!1,t,Object.create(a)))})},u.prototype.compute=function(e,t){var r,n=this,a=this.real_cell_name(e),o=this.cell_type_props(e),s=this.cell_parents(a),l=s.indexOf(t)==-1,c=this.cell_func(a),u=this.cell_arg_num(a);if(o.dynamic&&l){var f=this.dynamic_cells_props[e];c=f.func,s=f.parents,o={dynamic:!0},u=s.length}if(o.hasOwnProperty("map")&&o.map){if(!t)throw new Error("Cannot calculate map cell value - no parent cell name provided!");if(void 0===c[t])throw new Error("Cannot compute MAP cell: parent cell func undefined or not function!");c=c[t]}else if(o.closure){if(!this.cell_funcs[a]){var h=c();this.cell_funcs[a]=h}c=this.cell_funcs[a]}var p;switch(u){case 1:p=[this.cell_value(i.get_real_cell_name(s[0]))];break;case 2:p=[this.cell_value(i.get_real_cell_name(s[0])),this.cell_value(i.get_real_cell_name(s[1]))];break;case 3:p=[this.cell_value(i.get_real_cell_name(s[0])),this.cell_value(i.get_real_cell_name(s[1])),this.cell_value(i.get_real_cell_name(s[2]))];break;case 4:p=[this.cell_value(i.get_real_cell_name(s[0])),this.cell_value(i.get_real_cell_name(s[1])),this.cell_value(i.get_real_cell_name(s[2])),this.cell_value(i.get_real_cell_name(s[3]))];break;default:var p=this.cell_parents(a).map(function(e){return n.cell_value(i.get_real_cell_name(e))})}if(o.funnel){if(!t)throw new Error("Cannot calculate map cell value - no parent cell name provided!");t=i.get_real_cell_name(t),p=[t,this.cell_value(t)]}if(o.nested?p.unshift(function(e,t){var r=a+"."+e;n.set_cell_value(r,t),n.doRecursive(n.compute.bind(n),r,!0)}):o.async&&p.unshift(function(e){n.set_cell_value(a,e),n.doRecursive(n.compute.bind(n),a,!0,null,{},!0),n.changesFinished()}),o.hasOwnProperty("map")&&o.map)var r=c instanceof Function?c(this.cell_value(i.get_real_cell_name(t))):c;else{var r;switch(p.num){case 1:r=c(p[0]);break;case 2:r=c(p[0],p[1]);break;case 3:r=c(p[0],p[1],p[2]);break;default:r=c.apply(null,p)}}if(r===Firera.noop||r===this.cell_value(a)&&this.isValue(a))return Firera.noop;if(this.isSignal(a)){if(!r)return Firera.noop;r=!0}if(o.async||o.nested);else if(o.dynamic&&!l){var d=i.parse_arr_funcstring(r,e,{plain_base:{}},this.app.packagePool);i.parse_cell_type(e,d,this.dynamic_cells_props,[]),s=this.dynamic_cells_props[e].parents;var v=!0,_=!1,y=void 0;try{for(var m,g=s[Symbol.iterator]();!(v=(m=g.next()).done);v=!0){var b=m.value;this.linked_grids_provider.linkAnyTwoCells(b,e)}}catch(e){_=!0,y=e}finally{try{!v&&g.return&&g.return()}finally{if(_)throw y}}this.setLevel(e,s.concat(this.cell_parents(a))),this.compute(e)}else this.set_cell_value(a,r)},u.prototype.get=function(e,t){if(t){var r=t.split("/"),n=r[0],t=this.linked_grids_provider.get(n);if(!t)return console.warn("Cannot get - no such path",r),Firera.undef;var i=r[1]?r.slice(1).join("/"):void 0;return t.get(e,i)}var a=this.cell_values[e];return void 0===a?this.cell_values.hasOwnProperty(e)?a:Firera.undef:a},u.prototype.setLevel=function(e,t){var r=0,n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,c=this.levels[l];c>r&&(r=c)}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}this.levels[e]=r+1},u.prototype.updateTree=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=(Object.keys(e),Number.POSITIVE_INFINITY),i={};for(var a in e){if(r&&this.compute(a),!t){var o=r?this.cell_values[a]:e[a];this.set_cell_value(a,o)}var s=this.levels[a];s<n&&(n=this.levels[a]),i[s]||(i[s]=new Set),i[s].add(a)}for(var l=new Set,c=n,u={};void 0!==i[c];){var f=!0,h=!1,p=void 0;try{for(var d,v=i[c][Symbol.iterator]();!(f=(d=v.next()).done);f=!0){var _=d.value,y=!1,m=this.cell_children(_);this.cell_type(_);if(!this.cell_has_type(_,"free")&&(void 0===e[_]||t)&&this.cell_types[_].func){var g=this.compute(_,u[_]);g===Firera.noop&&(y=!0)}if(!this.cell_has_type(_,"async")&&!y)for(var b in m){var s=this.levels[b];i[s]||(i[s]=new Set),e[b]||i[s].add(b),u[b]=_;for(var k=s-1;k>c;k--)i[k]||(i[k]=new Set);l.has(b)&&console.log("skipping2",b)}}}catch(e){h=!0,p=e}finally{try{!f&&v.return&&v.return()}finally{if(h)throw p}}c++}},u.prototype.cellExists=function(e){return e=i.get_real_cell_name(e),this.cell_values.hasOwnProperty(e)||this.cell_types.hasOwnProperty(e)&&"fake"!==this.cell_types[e].type||this.fake_cells.indexOf(e)!==-1},u.prototype.set=function(e,t,r,n,i){if(r){var a=r.split("/"),o=a[0],r=this.linked_grids_provider.get(o);if(!r)return void console.warn("Cannot set - no such path",a);var s=a[1]?a.slice(1).join("/"):void 0;return void r.set(e,t,s)}if(!(e instanceof Object)){var l={};l[e]=t,e=l}if(i){var c={};for(var u in e)this.cell_value(u)===e[u]||(c[u]=e[u]);e=c}this.updateTree(e,n)},u.prototype.set2=function(e,t,r){var n=this;if(r){var i=r.split("/"),a=i[0],r=this.linked_grids_provider.get(a);if(!r)return void console.warn("Cannot set - no such path",i);var o=i[1]?i.slice(1).join("/"):void 0;return void r.set(e,t,o)}if(e instanceof Object)e.eachKey(function(t){n.force_set(t,e[t],!0),n.doRecursive(function(e){n.dirtyCounter[e]?n.dirtyCounter[e]++:n.dirtyCounter[e]=1},t)}),e.eachKey(this.doRecursive.bind(this,function(t,r){0===--n.dirtyCounter[t]&&void 0===e[t]&&n.compute(t,r)}));else{if("free"===!this.cell_type(e))throw Exception("Cannot set dependent cell!");this.force_set(e,t)}},u.prototype.force_set=function(e,t,r){var n=this;this.set_cell_value(e,t),r||o.eachKey(this.cell_children(e),function(t){n.doRecursive(n.compute.bind(n),t,!1,e)})},u.prototype.cell_parents=function(e){return this.cell_types[e]?this.cell_types[e].parents:[]},u.prototype.cell_arg_num=function(e){return this.cell_types[e]?this.cell_types[e].arg_num:0},u.prototype.cell_children=function(e){return this.cell_types[e]?this.cell_types[e].children:{}},u.prototype.all_cell_children=function(e,t){var r=this;return this.cell_types[e]?(t=t||[],o.eachKey(this.cell_types[e].children,function(e){t.push(e),r.all_cell_children(e,t)}),t):[]},u.prototype.cell_func=function(e){var t;if(t=this.cell_types[e].func)return t;throw new Error("Cannot find cell func for cell "+e)},u.prototype.cell_type=function(e){return this.cell_types[e]?this.cell_types[e].type:[]},u.prototype.cell_has_type=function(e,t){var r=this.cell_types[e];return!!r&&r.props[t]},u.prototype.cell_type_props=function(e){return this.cell_types[e]?this.cell_types[e].props:{}},u.prototype.isValue=function(e){return"="===this.cell_types[e].additional_type},u.prototype.isSignal=function(e){return"~"===this.cell_types[e].additional_type},u.prototype.real_cell_name=function(e){return this.cell_types[e]?this.cell_types[e].real_cell_name:{}},u.prototype.fake_cells=["$real_keys","$real_values","$path","$app_id","$name"],u.prototype.cell_value=function(e){var t=this;switch(e){case"$real_keys":return[].concat(n(new Set(Object.keys(this.plain_base).concat(Object.keys(this.plain_base.$init))))).filter(function(e){return e.match(/^(\w|\d|\_|\-)*$/)});case"$real_values":var r={};return o.each([].concat(n(new Set(Object.keys(this.cell_values).concat(Object.keys(this.init_values))))).filter(function(e){return e.match(/^(\w|\d|\_|\-)*$/)}),function(e,n){r[e]=t.cell_value(e)}),r;case"$path":return this.path;case"$app_id":return this.app.id;case"$name":return this.name;default:return this.cell_values.hasOwnProperty(e)?this.cell_values[e]:Firera.undef}},u.prototype.set_cell_value=function(e,t){var r=this;t===this.cell_values[e];this.cell_values[e]=t,this.side_effects[e]&&(i.side_effects[this.side_effects[e]]||console.info("I SHOULD SET side-effect",e,this.side_effects[e],i.side_effects),i.side_effects[this.side_effects[e]].func.call(this,e,t)),this.cell_types["*"]&&"*"!==e&&this.asterisk_omit_list.indexOf(e)===-1&&this.set("*",[e,t]),this.dynamic_cell_links[e]&&o.each(this.dynamic_cell_links[e],function(n,i){var a="__self"===i,o=a?r:r.linked_grids_provider.get(i);if(o){var s=!0,l=!1,c=void 0;try{for(var u,f=n[Symbol.iterator]();!(s=(u=f.next()).done);s=!0){var h=u.value;"val"===h.type?o.set(h.cell_name,t):"dynamic"===h.type?o.compute(h.cell_name,e):o.set(h.cell_name,[a?e:r.name,t])}}catch(e){l=!0,c=e}finally{try{!s&&f.return&&f.return()}finally{if(l)throw c}}}}),this.app.linkManager.checkUpdate(this.id,e,t)},t.exports=u},{"./Parser":5,"./utils":13}],3:[function(e,t,r){"use strict";var n=e("./utils"),i=function(e){this.app=e,this.links=[],this.linkStruct={},this.workingLinks={},this.pointers={},this.doubleAsterisk={},this.pathToId={}};i.prototype.onNewGridAdded=function(e,t){var r=this.app.getGrid(t).path;for(var n in this.doubleAsterisk)if(0===r.indexOf(n))for(var i in this.doubleAsterisk[n])this.addWorkingLink(t,i,this.pathToId[n],"**/"+i,"**",r);for(var a in this.pointers[e])this.actualizeLink(a,t)},i.prototype.refreshPointers=function(e){for(var t in this.pointers){var r=this.pointers[t];for(var i in r)r[i]==e&&r.splice(i,1)}var a=this.links[e],o=!0,s=!1,l=void 0;try{for(var c,u=a.pointers[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var f=c.value;n.init_if_empty(this.pointers,f.grid_id,{},e,a.path[f.pos])}}catch(e){s=!0,l=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw l}}},i.prototype.checkUpdate=function(e,t,r){if(this.workingLinks[e]&&this.workingLinks[e][t]){if(void 0===r&&(r=this.app.getGrid(e).get(t)),r===Firera.undef)return;var n=this.workingLinks[e][t];for(var i in n)for(var a in n[i]){var o=r;if(n[i]&&n[i][a]){var s=n[i][a];if("**"===s.link_id)o=[o,s.path];else{var l=this.links[s.link_id];if(l)for(var c=l.path.length-1;c>-1;c--)"*"===l.path[c]&&(o=[s.path[c+1],o])}}var u=this.app.getGrid(i);if(u)u.set(a,o);else{this.links[s.link_id]}}}},i.prototype.addWorkingLink=function(e,t,r,i,a,o){n.init_if_empty(this.workingLinks,e,{},t,{},r,{},i,{link_id:a,path:o}),this.app.getGrid(e).initIfSideEffectCell(t),this.checkUpdate(e,t)},i.prototype.actualizeLink=function(e,t){var r,n=this,i=this.links[e],a=(i.grid_id,function a(o,s,l,c){c=c.slice();var u=n.app.getGrid(o);c.indexOf(u.name)!==-1||c.push(u.name);var f,h=i.path[s];if(!i.path[s+1])return i.pointers[l].fixed||i.pointers.splice(l,1),void n.addWorkingLink(o,h,i.grid_id,i.slave_cellname,e,c);if(".."===h)f=u.parent;else if("*"===h){if(s!==r.pos){i.pointers[l].fixed||i.pointers.splice(l,1),i.pointers.push({pos:s,grid_id:o,fixed:!0,path:c});for(var p in u.linked_grids){var d=u.linked_grids[p];a(d,s+1,l,c)}return}if(void 0!==t)a(t,s+1,l,c);else{i.pointers[l].fixed=!0,i.pointers[l].grid_id=o;for(var p in u.linked_grids){var d=u.linked_grids[p];a(d,s+1,l,c)}}}else{if(!u.linked_grids||void 0===u.linked_grids[h])return;f=u.linked_grids[h]}void 0!==f&&a(f,s+1,l,c)});for(var o in i.pointers){var r=i.pointers[o];a(r.grid_id,r.pos,o,r.path)}this.refreshPointers(e)},i.prototype.initLink=function(e,t,r){var i=this,a=t.split("/");if(2==a.length&&".."===a[0],"**"==a[0]){if(a.length>2)return void console.error("You cannot listen to such path",a.join("/"));var o=a[1],s=this.app.getGrid(e).path;return this.pathToId[s]=e,n.init_if_empty(this.doubleAsterisk,s,{},o,!0),void this.app.eachChild(e,function(t){i.addWorkingLink(t.id,o,e,"**/"+o,"**",t.path)})}if("^^"==a[0]){if(a.length>2)return void console.error("You cannot listen to such path",a.join("/"));var o=a[1];return void this.app.eachParent(e,function(t){i.addWorkingLink(t.id,o,e,"^^/"+o)})}if(""==a[0]){if(a.length>2)return void console.error("You cannot listen to such path",a.join("/"));var o=a[1],s=this.app.getGrid(e).path;return void this.addWorkingLink(this.app.grids[1].id,o,e,"/"+o)}var l={path:a,target:a[a.length-1],pointers:[{pos:0,path:[],grid_id:e,fixed:!1}],str:t,slave_cellname:r||t,grid_id:e,status:null};if(n.init_if_empty(this.linkStruct,e,{}),void 0==this.linkStruct[e][t]){var c=this.links.push(l)-1;this.linkStruct[e][t]=c,this.actualizeLink(c)}else this.actualizeLink(this.linkStruct[e][t])},t.exports=i},{"./utils":13}],4:[function(e,t,r){"use strict";var n=e("./utils"),i=function(e,t){for(var r in e)t[r]=e[r]},a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];this.app_id=t,this.cellMatchers=Object.assign({},e.cellMatchers),this.macros=Object.assign({},e.macros),this.eachGridMixin=Object.assign({},e.eachGridMixin)};a.prototype.load=function(e){if("string"==typeof e){if(!Firera.packagesAvailable[e])return void console.error("Package not found!",e);e=Firera.packagesAvailable[e]}i(e.cellMatchers,this.cellMatchers),i(e.macros,this.macros),e.eachGridMixin&&Object.assign(this.eachGridMixin,e.eachGridMixin),e.onGridCreated&&(n.init_if_empty(Firera.onGridCreatedStack,this.app_id,[]),Firera.onGridCreatedStack[this.app_id].push(e.onGridCreated)),e.onBranchCreated&&(n.init_if_empty(Firera.onBranchCreatedStack,this.app_id,[]),Firera.onBranchCreatedStack[this.app_id].push(e.onBranchCreated))},t.exports=a},{"./utils":13}],5:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=e("./utils"),o=a.Obj,s=(a.Arr,new Set(["is","async","closure","funnel","dynamic","nested"])),l=function(){var e=1;return function(){return"@@@_"+ ++e}}(),c=function(e){console.error(e)},u={"=":{type:"func",func:function(e,t){return e==t}},"==":{type:"func",func:function(e,t){return e===t}},"!=":{type:"func",func:function(e,t){return e!=t}},"!==":{type:"func",func:function(e,t){return e!==t}},"+":{type:"func",func:function(e,t){return(e?Number(e):0)+(t?Number(t):0)}},"-":{type:"func",func:function(e,t){return Number(e)-Number(t)}},"*":{type:"func",func:function(e,t){return e*t}},"/":{type:"func",func:function(e,t){return e/t}},"%":{type:"func",func:function(e,t){return e%t}},$:{type:"func",func:function(e,t){return console.log("Searching selector",t,"in",e),e.find(t)}}},f=function(e){return e.replace(/^(\:|\-|\=|\~)/,"")},h=function(e,t){for(var r in t.cellMatchers){var n=t.cellMatchers[r],i=e.match(n.regexp);if(i)return[n,i]}},p=function(e){!e.match;var t=e.match(/^(\:|\-|\=)/);return[{"=":"skip_same","-":"passive",val:"normal"}[t?t[1]:"val"],e.replace(/^(\:|\-|\=)/,"")]},d=function(e,t,r,n,i){var o=a.split_camelcase(t)||[],s=o.indexOf("closure")!==-1,l=o.indexOf("async")!==-1,u=o.indexOf("nested")!==-1,f=o.indexOf("funnel")!==-1,h=o.indexOf("dynamic")!==-1;return(l&&u||h&&u)&&c("Incompatible cell types: "+o.join(", ")),{type:t,additional_type:i,func:r,props:{closure:s,async:l,nested:u,funnel:f,dynamic:h},real_cell_name:e.replace(/^(\:|\-)/,""),parents:n||[],arg_num:n?n.length:0,children:[]}},v=function(e,t,r,n){var o;e!==g(e)&&(o=e[0],e=g(e));var s=r,l="free";if("$children"!==e)if("$init"!==e){if(!(t instanceof Array))return void(s[e]=d(e,l));var c=t[0],u=t.slice(1);c instanceof Function?l="is":(l=c,c=u.shift()),s[e]=d(e,l,c,u,o);for(var f in u){var h=p(u[f]),v=i(h,2),_=v[0],y=v[1];"passive"!==_&&(a.init_if_empty(n,y,{}),n[y][e]=!0)}}else for(var f in t)s[f]=d(e,l)},_=function(e){var t={},r={},n={};for(var i in e){var o=g(i);n[o]||(v(i,e[i],t,r),n[o]=!0)}for(var s in r){if(!t[s]){var l=a.is_special(s)?"free":"fake";t[s]=d(s,l)}t[s].children=r[s]}return t},y=function(e,t,r,n){var i;e=e.slice();var l=e[0];n.macros.hasOwnProperty(l)&&(e=n.macros[l](e.slice(1)),l=e[0],e=e.slice()),l||console.error("wrong func:",l);var c=a.split_camelcase(l);if(1===e.length&&"string"==typeof e[0])i=["is",a.id,e[0]];else if(l instanceof Function)i=["is"].concat(e);else if(s.has(c[0]))switch(l){case"nested":var f=e[2].map(function(e){return t+"."+e});a.init_if_empty(r.plain_base,"$init",{}),o.each(f,function(e){r.plain_base.$init[e]=null}),e.splice(2,1),i=e;break;default:i=e}else{if("just"===l)return a.init_if_empty(r.plain_base,"$init",{}),void(r.plain_base.$init[t]=e[1]);if(!u[l])throw new Error("Cannot find predicate: "+l,e);var h=u[l];switch(h.type){case"func":i=["is",h.func].concat(e.slice(1))}}return i},m={child:{func:function(e,t,r){if(t&&this.linkGrid(e,t),t===!1){var n=e.replace("$child_","");this.unlinkChild(n)}},regexp:/^\$child\_/},children:{regexp:/^\$all\_children$/,func:function(e,t){var r=this;t&&t instanceof Object&&o.eachKey(t,function(e){if(t[e]){var n=i(t[e],4),a=n[0],o=n[1],s=n[2],l=n[3];switch(a){case"remove":r.unlinkChild(o);break;case"add":r.linkGrid(o,[s,null,null,l]);break;case"change":r.updateChildFreeValues(o,l,!0);break;default:throw new Error("Unknown action: "+a)}}})}}},g=function(e){return"-"===e[0]?e.slice(1):"="===e[0]?e.slice(1):"~"===e[0]?e.slice(1):e},b=function(e,t,r,n,i){if(e.indexOf("/")!==-1){var o=e.split("/");return void(t.initLinkChain?t.initLinkChain(e):a.init_if_empty(t,"link_chains",{},e,o))}var s=g(e);for(var l in m){var c=m[l],u=s.match(c.regexp);u&&(a.init_if_empty(t,"side_effects",{},e,[]),t.side_effects[e].indexOf(l)===-1&&t.side_effects[e].push(l))}var f=h(s,n);f&&f[0].func(f[1],t,r,n)},k=function(e,t){for(var r in e.plain_base)if("$init"!==r)if("$children"!==r)x(e.plain_base[r],e,r,t);else{var n=e.plain_base.$children;n instanceof Array||"string"==typeof n?x(n,e,"$all_children",t):o.each(n,function(n,i){if(n instanceof Array)r="$child_"+i,x(n,e,r,t);else if("string"==typeof n)e.grids_to_link[i]=n;else if(n.add||n.remove){var a={};n.add&&(a[n.add]=function(){return{type:n.type,action:"add"}}),n.remove&&(a[n.remove]=function(){return{action:"remove"}}),x(["map",a],e,"$child_"+i,t)}else e.grids_to_link[i]=n.type})}return e},x=function e(t,r,i,o){var s;if(i=g(i),!(t instanceof Array))return a.init_if_empty(r.plain_base,"$init",{}),b(i,r,"setter",o),void(r.plain_base.$init[i]=t);if(s=y(t,i,r,o),void 0!==s){s[2]||a.init_if_empty(r,"no_args_cells",{},i,!0);for(var c=2;c<s.length;++c){var u=s[c];switch("undefined"==typeof u?"undefined":n(u)){case"string":b(u,r,null,o);break;case"object":if(u instanceof Array){var f=l();e(u,r,f,o),s[c]=f}break;default:throw new Error("Not know how to handle this "+("undefined"==typeof u?"undefined":n(u)))}}b(i,r,"setter",o),r.plain_base[i]=s}},w={};w.parse_cell_types=_,w.parse_pb=k,w.parse_fexpr=x,w.parse_cellname=b,w.real_cell_name=f,w.get_real_cell_name=g,w.get_random_name=l,w.side_effects=m,w.parse_arr_funcstring=y,w.parse_cell_type=v,w.findMatcher=h,w.system_macros=s,t.exports=w},{"./utils":13}],6:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i=e("../ozenfant/ozenfant"),a=n(i),o=e("./Parser"),s=n(o),l=e("./App"),c=e("./PackagePool"),u=e("./utils"),f=u.Obj,h=e("./Grid"),p=e("./packages/SimpleHtmlTemplates"),d=e("./packages/Che"),v=e("./packages/OzenfantOld"),_=e("./packages/HtmlCells"),y=e("./packages/Core"),m=e("./packages/NeuOzenfant"),g=function(e){return void 0!==e&&e!==Firera.undef},b=function(e){var t=new l(e,k);return l.apps.push(t),t};window.Firera=function(e){arguments.length>1&&(e=Firera.join.apply(null,arguments));var t=(performance.now(),b(e.$packages));if(t.cbs=f.map(e,t.parse_cbs.bind(t),{except:["$packages"]}),!t.cbs.$root)throw new Error("Cant find root app!");return++t.grid_create_counter,t.root=new h(t,"$root",!1,{$app_id:t.id},null,null,"/"),Firera.gridCreated(t,t.root.id,t.root.path,null),--t.grid_create_counter,0===t.grid_create_counter&&t.branchCreated(1),t},Firera.onGridCreatedStack={},Firera.onBranchCreatedStack={},Firera.gridCreated=function(e,t,r,n){if(Firera.onGridCreatedStack[e.id]){var i=!0,a=!1,o=void 0;try{for(var s,l=Firera.onGridCreatedStack[e.id][Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;c(e,t,r,n)}}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}}};var k=new c;Firera.undef=new function(){},Firera.noop=new function(){},Firera.apps=l.apps,Firera.run=Firera,Firera.Ozenfant=a.default,Firera.is_def=g,Firera.getAppStruct=function(){return Firera.apps.map(l.get_app_struct)},Firera.loadPackage=function(e){k.load(e)},Firera.join=function(){for(var e=function(e,t){for(var r in t)e[r]=t[r]},t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=Object.assign({},r[0]);for(var a in r){var o=r[a];if(0!==a)for(var s in o)"$packages"!==s?(u.init_if_empty(i,s,{}),e(i[s],o[s])):(u.init_if_empty(i,s,[]),i.$packages=i.$packages.concat(o[s]))}return i},Firera.loadPackage(y),Firera.loadPackage(d),Firera.packagesAvailable={simpleHtmlTemplates:p,htmlCells:_,ozenfant:v,ozenfant:m,che:d},Firera.func_test_export={parse_pb:s.default.parse_pb,parse_fexpr:s.default.parse_fexpr
},Firera._=u,t.exports=Firera},{"../ozenfant/ozenfant":16,"./App":1,"./Grid":2,"./PackagePool":4,"./Parser":5,"./packages/Che":7,"./packages/Core":8,"./packages/HtmlCells":9,"./packages/NeuOzenfant":10,"./packages/OzenfantOld":11,"./packages/SimpleHtmlTemplates":12,"./utils":13}],7:[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var i=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=e("../../shche/shche");t.exports={macros:{che:function(e){var t=i(e,2),e=t[0],r=t[1];r=r||[];var o,s=a.create.apply(a,[e,{onOutput:function(e,t){},onSuccess:function(){o(s.state)}}].concat(n(r))),l=["asyncClosureFunnel",function(){return function(e,t,r){return o=e,s.drip(t,r),"a"}}].concat(n(s.needed_events));return l}}}},{"../../shche/shche":18}],8:[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function i(e){return Array.isArray(e)?e:Array.from(e)}var a=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("../Parser"),s=e("../utils"),l=s.Obj,c=(s.Arr,function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null===e)return null;if("$root"===e)return document.querySelector("body");if(t=s.raw(t),!t)return null;var r=!0,n=!1,i=void 0;try{for(var a,o=t.children[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var l=a.value;if(l.getAttribute("data-fr")==e)return l}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return null}),u=function(e,t){if(t)return t.map(function(t,r){var n=t.slice();return n[3]=n[2],n[2]=e,n})},f=function(){var e=[],t=-1,r={};return function(n){var i=[];return s.arr_different(n,e,function(e){r[e]=++t,i.push(["add",t,n[e]])}),s.arr_different(e,n,function(e){i.push(["remove",r[e]]),delete r[e]}),s.arr_common(e,n,function(e){i.push(["change",r[e],n[e]])}),e=s.sh_copy(n),i}};t.exports={cellMatchers:{prevValue:{name:"PrevValue",regexp:new RegExp("^(-|:)?\\^(.*)","i"),func:function(e,t,r,n){if("setter"!=r){var i=e[2];o.parse_fexpr(["closure",function(){var e;return function(t){var r=e;return e=t,[r,t]}},i],t,"^"+i,n)}}}},macros:{interval:function(e){var t=a(e,2),r=t[0],n=t[1];return n?["asyncClosure",function(){var e,t=!1;return function(n,i){i!==t&&(Firera.is_def(i)&&i?e=setInterval(n,r):clearInterval(e),t=i)}},n]:["asyncClosure",function(){return function(e){setInterval(e,r)}}]},toggle:function(e){var t=a(e,2),r=t[0],n=t[1];return["closure",function(){var e=void 0===n||n;return function(t){return e=!e}},r]},skipIf:function(e){var t=i(e),r=t[0],a=t[1],o=t.slice(2);return["asyncClosure",function(){var e=[];return function(t){for(var n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];if(r(e,i)){var s=a.apply(null,i);e=i,t(s)}}}].concat(n(o))},transist:function(e){var t;return e[0]instanceof Function&&(t=e.shift()),[function(e,r){return e?t?t(r):r:Firera.noop}].concat(e)},map:function e(t){var r=a(t,1),e=r[0],i=Object.keys(e),o=function(t,r){return e[t]instanceof Function?e[t](r):e[t]};return["funnel",o].concat(n(i))},transistAll:function(e){var t=i(e),r=t[0],n=t.slice(1);return[function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e?r.apply(n):Firera.noop}].concat(n)},"&&":function(e){return[function(e,t){return e&&t}].concat(e)},"==":function(e){return[function(e,t){return e==t}].concat(e)},"!":function(e){return[function(e){return!e}].concat(e)},equal:function(e){return[function(e,t){return e===t}].concat(e)},"+":function(e){return[function(e,t){return Number(e)+Number(t)}].concat(e)},"-":function(e){return[function(e,t){return e-t}].concat(e)},"*":function(e){return[function(e,t){return e*t}].concat(e)},"/":function(e){return[function(e,t){return e/t}].concat(e)},"%":function(e){return[function(e,t){return e%t}].concat(e)},accum:function(e){return["closure",function(){var e=[];return function(t){return e.push(t),e}},e[0]]},first:function(e){return[function(e){return e}].concat(n(e))},second:function(e){return[function(e,t){return t}].concat(n(e))},firstDefined:function(e){return[function(){for(var e in arguments)if(void 0!==arguments[e])return arguments[e]}].concat(n(e))},firstTrue:function(e){return[function(){for(var e in arguments)if(arguments[e])return arguments[e]}].concat(n(e))},valMap:function e(t){var e;t[0]instanceof Object&&!(t[0]instanceof Array)?e=funstring.shift():(e={},e[t[0]]=!0,e[t[1]]=!1);var r=function(t,r){return e[t]};return["funnel",r].concat(n(t))},firstTrueCb:function(e){var t=e[0],r=e.slice(1);return[function(){for(var e in arguments)if(t(arguments[e]))return arguments[e]}].concat(n(r))},asArray:function(e){var t="*/*";if(e[0]instanceof Array){var r=e[0].map(function(e){return"*/"+e});t=["funnel",s.ids].concat(n(r))}return["closureFunnel",function(){var e=[];return function(t,n){if("$arr_data.changes"===t)for(var i in n){var o=a(n[i],4),l=o[0],c=o[1],u=(o[2],o[3]);if("add"===l){var f={},h=!0,p=!1,d=void 0;try{for(var v,_=r[Symbol.iterator]();!(h=(v=_.next()).done);h=!0){var y=v.value;y=y.replace("*/",""),f[y]=u[y]}}catch(e){p=!0,d=e}finally{try{!h&&_.return&&_.return()}finally{if(p)throw d}}e[c]=f}else"remove"===l&&delete e[c]}else if(n){var m=a(n,2),g=m[0],b=m[1];g=g.replace("*/",""),b&&(e[b[0]][g]=b[1])}return s.arr_fix_keys(e)}},t,"$arr_data.changes"]},indices:function(e){var t=e[0],r="*/"+e[1];return e[1]||(r="*/"+t,t=s.id),["closureFunnel",function(){var e=new Set;return function(n,i){if(r===n){var o=a(i,2),s=o[0],l=o[1],c=t(l);c?e.add(s):e.delete(s)}else{if(!i)return e;var u=!0,f=!1,h=void 0;try{for(var p,d=i[Symbol.iterator]();!(u=(p=d.next()).done);u=!0){var v=a(p.value,2),_=v[0],y=v[1];"remove"===_&&e.delete(y)}}catch(e){f=!0,h=e}finally{try{!u&&d.return&&d.return()}finally{if(f)throw h}}}return e}},r,"$arr_data.changes"]},reduce:function(e){var t="*/"+e[0],r=e[1],n=r.def,i={};return["closureFunnel",function(){return function(t,o){var s,l;if("$arr_data.changes"===t){if(o instanceof Array)for(var c in o){if(!o[c]instanceof Array)return;var u=o[c][0];s=o[c][1],l=o[c][3]?o[c][3][e[0]]:void 0,"add"===u&&(n=r.add(l,n),i[s]=l),"remove"===u&&(n=r.add(i[s],n),delete i[s])}}else if(o){var f=a(o,2);s=f[0],l=f[1],n=r.change(l,i[s],n),i[s]=l}return n}},t,"$arr_data.changes"]},count:function(e){var t=e[0],r=t.split("/");t=r.pop();var n=r.length?r.join("/")+"/":"";return"*"===t?[n+"$arr_data.length"]:["closureFunnel",function(){var e=0,t={};return function(r,n){if("$arr_data.changes"==s.path_cellname(r))return l.each(n.filter(function(e){return"remove"===e[0]}),function(r){t[r[1]]&&e--,delete t[r[1]]}),e;if(!n)return e;var i=a(n,2),o=i[0],c=i[1],u=t[o];return void 0===u?c&&e++:u!==c&&(c?e++:e--),t[o]=c,e}},n+"*/"+t,n+"$arr_data.changes"]},join:function(e){return["funnel",s.second].concat(e)},list:function(e){var t=e[0];!t instanceof Object&&console.error("List properties should be an object!");var r=t.type;t.push||t.datasource||t.deltas||t.data||e[1]||console.warn("No item source provided for list",e);var n;n=t.push?["map",{$push:function(e){if(e)return[["add",null,e]]},$pop:function(e){if(e||0===e||"0"===e){if(e instanceof Array||e instanceof Set){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;t.push(["remove",s])}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return t}return[["remove",e]]}}}]:t.deltas?[id,t.deltas]:t.data?["closure",f,["just",t.data]]:["closure",f,"$datasource"];var i={$no_auto_template:!0,$deltas:n,$arr_data:["nestedClosure",function(){var e=-1,t=0;return function(n,i){if(i&&i.length){var a=u(r,i);a.forEach(function(r){switch(r[0]){case"add":r[1]=String(e<1e6?++e:-1),++t;break;case"remove":--t}}),n("changes",a),n("length",t)}}},"$deltas"],$list_template_writer:["nestedClosure",function(){var e=3,t={};return function(r,n,i){if(i!==Firera.undef&&i){for(var a in n){var o=n[a][0],s=n[a][1];switch(o){case"add":i.append('<div data-fr="'+ ++e+'" data-fr-name="'+s+'"></div>'),t[s]=e;break;case"remove":i.children("[data-fr="+t[s]+"]").remove()}}return r("dummy",!0),r("index_map",t),!0}}},"$arr_data.changes","$real_el"],$htmlbindings:["closure",function(){return function(e,t){if(e&&t){var r=l.map(t,function(r,n){return c(t[n],e)});return r}}},"$real_el","$list_template_writer.index_map"],$children:["$arr_data.changes"]};t.push&&(i.$push=t.push,!t.push instanceof Array&&console.error("List's PUSH property should be a F-expression(array), given",t.push)),t.pop&&(i.$pop=t.pop,!t.pop instanceof Array&&console.error("List's POP property should be a F-expression(array), given",t.pop)),t.datasource&&(i.$datasource=t.datasource);var a,o=Object.assign(i,t.self||{});return a=t.create_destroy?[function(e){return!!e&&o},t.create_destroy]:[s.always(o)]},arrDeltas:function(e){var t=e[0];return["closure",function(){var e=[];return function(t){var r=s.arrDeltas(e,t);return e=t,r}},t]}}}},{"../Parser":5,"../utils":13}],9:[function(t,r,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var a=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=t("../Parser");!function(){function e(e){return l?l:l=e.matches?e.matches:e.webkitMatchesSelector?e.webkitMatchesSelector:e.mozMatchesSelector?e.mozMatchesSelector:e.msMatchesSelector?e.msMatchesSelector:e.oMatchesSelector?e.oMatchesSelector:s.matchesSelector}function t(r,n,i){if("_root"==n)return i;if(r!==i){if(e(r).call(r,n))return r;if(r.parentNode)return c++,t(r.parentNode,n,i)}}function n(e,t,r,n){f[e.id]||(f[e.id]={}),f[e.id][t]||(f[e.id][t]={}),f[e.id][t][r]||(f[e.id][t][r]=[]),f[e.id][t][r].push(n)}function i(e,t,r,n){if(f[e.id])if(t)if(n||r)if(n){if(f[e.id][t][r])for(i=0;i<f[e.id][t][r].length;i++)if(f[e.id][t][r][i]===n){f[e.id][t][r].splice(i,1);break}}else delete f[e.id][t][r];else f[e.id][t]={};else for(var i in f[e.id])f[e.id].hasOwnProperty(i)&&(f[e.id][i]={})}function a(e,r,n){if(f[e][n]){var i,a,o=r.target||r.srcElement,l={},u=a=0;c=0;for(i in f[e][n])f[e][n].hasOwnProperty(i)&&(a=t(o,i,h[e].element))&&s.matchesEvent(n,h[e].element,a,"_root"==i,r)&&(c++,f[e][n][i].match=a,l[c]=f[e][n][i]);for(r.stopPropagation=function(){r.cancelBubble=!0},a=0;a<=c;a++)if(l[a])for(u=0;u<l[a].length;u++){if(!1===l[a][u].call(l[a].match,r))return void s.cancel(r);if(r.cancelBubble)return}}}function o(e,t,r,o){function l(e){return function(t){a(u,t,e)}}if(this.element){e instanceof Array||(e=[e]),r||"function"!=typeof t||(r=t,t="_root");var c,u=this.id;for(c=0;c<e.length;c++)o?i(this,e[c],t,r):(f[u]&&f[u][e[c]]||s.addEvent(this,e[c],l(e[c])),n(this,e[c],t,r));return this}}function s(e,t){if(!(this instanceof s)){for(var r in h)if(h[r].element===e)return h[r];return u++,h[u]=new s(e,u),h[u]}this.element=e,this.id=t}var l,c=0,u=0,f={},h={};s.prototype.on=function(e,t,r){return o.call(this,e,t,r)},s.prototype.off=function(e,t,r){return o.call(this,e,t,r,!0)},s.matchesSelector=function(){},s.cancel=function(e){e.preventDefault(),e.stopPropagation()},s.addEvent=function(e,t,r){e.element.addEventListener(t,r,"blur"==t||"focus"==t)},s.matchesEvent=function(){return!0},"undefined"!=typeof r&&r.exports&&(r.exports=s),window.Gator=s}();var s=function(e,t){if(e)for(var r=e.target;r;){if(r.getAttribute("data-fr-grid-root"))return!1;if(r=r.parentNode,r===t)break}return!0},l={attr:function(e,t){if(e){for(attrName in t)e.setAttribute(attrName,t[attrName]);return e}}},c=function(e){return e instanceof Node||!e?e:e[0]},u=function(e,t){return e(t)},f=function(e,t){var r=t.target,n=!0,o=!1,s=void 0;try{for(var c,u=pipe[Symbol.iterator]();!(n=(c=u.next()).done);n=!0){var f=a(c.value,2),h=f[0],p=f[1];l[h]?r=l[h].apply(l,[r].concat(i(p))):console.error("Unknown pipe aspect:",h)}}catch(e){o=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw s}}return e(r)},h=function(e,t,r){var n,i=e.getAttribute("class")||"",a=i.split(" "),o=a.indexOf(t);n=void 0!==r?r:o===-1,n?e.setAttribute("class",i+" "+t):(o!==-1&&a.splice(o,1),e.setAttribute("class",a.join(" ")))},p=function t(r,n,i){var a;if(n instanceof $){var o=!0,s=!1,l=void 0;try{for(var c,u=n[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var f=c.value;t(r,f)}}catch(e){s=!0,l=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw l}}}else document.createEvent?(a=document.createEvent("HTMLEvents"),a.initEvent(r,!0,!0)):(a=document.createEventObject(),a.eventType=r),a.eventName=r,i&&(e.target=i),document.createEvent?n.dispatchEvent(a):n.fireEvent("on"+a.eventType,a)};r.exports={cellMatchers:{HTMLAspects:{name:"HTMLAspects",regexp:new RegExp("^(-|:)?([^|]*)?\\|(.*)","i"),func:function e(t,r,n,i){var l=function(e){var t=e.match(/([^\(]*)\(([^\)]*)\)/);return t&&t[1]&&(e=t[1],t=t[2].split(",")),[e,t||[]]},d=t[0],v=t[3].split("|"),_=v[0],y=v.slice(1);y.length&&(y=y.map(l));var e,m,g=y.length?f:u,b=t[2],k=!1,x=new Set(["visibility","display","setval","hasClass","css"]),w=l(_),S=a(w,2);if(_=S[0],m=S[1],">"===_[0]&&(k=!0,_=_.substr(1)),!("setter"===n&&!x.has(_)||"setter"!==n&&x.has(_))){switch(_){case"getval":e=function(e,t){var r=function(t){var r,n=t.getAttribute("type");r="checkbox"==n?t.hasAttribute("checked"):t.value,g(e,r)},n=a(t,2),i=n[0],o=n[1],l=c(i),u=c(o),f=function(e){(k||s(e,u))&&r(e.target)},h=function(t){if(k||s(t,u)){var r,n=t.target,i=n.getAttribute("type");"checkbox"!=i&&(r=n.value,g(e,r))}};Firera.is_def(i)&&(Gator(l).off("keyup",b),Gator(l).off("change",b)),Firera.is_def(o)&&(Gator(u).on("keyup",b,h),Gator(u).on("change",b,f))};break;case"click":e="other"===b?function(e,t){if(t){var r=a(t,2),n=r[0],i=r[1];n=c(n),i=c(i),Firera.is_def(i)&&document.addEventListener("click",function(t){var r=t.srcElement||t.originalTarget,n=!$.contains(i,r);n&&g(e,!0)})}}:function(e,t){if(t){var r=a(t,2),n=r[0],i=r[1];if(Firera.is_def(i)){var o=c(n),l=c(i);o&&o!==Firera.undef&&Gator(o).off("click"),0===i.length&&console.warn("Assigning handlers to nothing",i),Gator(l).on("click",b,function(t){(k||s(t,l))&&(g(e,t),t.originalEvent&&t.originalEvent.target&&p("click",document,t.originalEvent.target),t.preventDefault())})}}};break;case"focus":e=function(e,t){if(t){var r=a(t,2),n=(r[0],r[1]);if(Firera.is_def(n)){var i=c(n);Gator(i).on("focus",b,function(t){if(k||s(t,i))return g(e,t),!1})}}};break;case"press":e=function(e,t){var r=a(t,2),n=(r[0],r[1]);Firera.is_def(n)&&(n=c(n),Gator(n).on("keyup",b,function(t){if(k||s(t,n)){var r={13:"Enter",27:"Esc"};m.indexOf(r[t.keyCode])!==-1&&g(e,t)}}))};break;case"hasClass":e=function(e,t){if(Firera.is_def(e)){Firera.is_def(t)||(t=!1),e=c(e);var r=m,n=a(r,1),i=n[0];h(e,i,t)}};break;case"enterText":e=function(e,t){var r=a(t,2),n=(r[0],r[1]);if(n){var i=c(n);i.onkeyup=function(t){if(t.target===i.querySelector(b)){if(!k&&!s(t,i))return;13==t.keyCode&&g(e,t.target.value)}}}};break;case"visibility":e=function(e,t){Firera.is_def(e)&&void 0!==t&&(e=c(e),t?e.style.visibility="visible":e.style.visibility="hidden")};break;case"css":var O=m,A=a(O,1),F=A[0];e=function(e,t){e.style[F]=t};break;case"display":e=function(e,t){Firera.is_def(e)&&void 0!==t&&(e=c(e),t?e.style.display="block":e.style.display="none")};break;case"setval":e=function(e,t){Firera.is_def(e)&&Firera.is_def(t)&&(e=c(e),e.value=t)};break;default:throw new Error("unknown HTML aspect: "+_)}"setter"===n?o.parse_fexpr([e,[function(e){if(!Firera.is_def(e))return!1;if(!b)return e;if("other"===b)return e;if(e=c(e),!e)return e;var t=e.querySelectorAll(b);return t},"-$real_el","$html_skeleton_changes"],d],r,o.get_random_name(),i):o.parse_fexpr(["asyncClosure",function(){var t;return function(r,n){e(r,[t,n]),t=n}},"-$real_el","$html_skeleton_changes"],r,d,i)}}}}}},{"../Parser":5}],10:[function(e,t,r){"use strict";var n,i=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a={},o={},s={},l=e("../utils"),c=l.raw,u=function e(t,r,n){var i=t.getGrid(r),a={val:i.cell_values[n],grid_id:r,children:{}};for(var o in i.linked_grids){var s=i.linked_grids[o];a.children[o]=e(t,s,n)}return a},f=function(e){return Object.keys(e.children).length&&!e.children[0].val},h=function(e,t){var r=e.getGrid(t).getChildrenValues();return r},p=function e(t,r,n,i){var c=t.getGrid(r.grid_id);if(l.init_if_empty(a,t.id,{},c.id,!0),r.val){var u=Object.assign({},c.cell_values);l.init_if_empty(o,t.id,{}),o[t.id][c.path]=r.tmpl=new Firera.Ozenfant(r.val);for(var p in r.children)f(r.children[p])?(u[p]=h(t,r.children[p].grid_id),e(t,r.children[p],c.path,!0)):u[p]=e(t,r.children[p],c.path);return r.tmpl.getHTML(u)}if(!i){var d=[];for(var v in r.children)d.push(e(t,r.children[v]));return d.join("")}l.init_if_empty(s,t.id,{});var _=c.path.replace(n,"/"),y=_.split("/"),d="",m=!0,g=!1,b=void 0;try{for(var k,x=y[Symbol.iterator]();!(m=(k=x.next()).done);m=!0){var w=k.value;""!==w&&(d+=Number(w)==w?"["+w+"]":"/"+w)}}catch(e){g=!0,b=e}finally{try{!m&&x.return&&x.return()}finally{if(g)throw b}}s[t.id][c.path]={template:o[t.id][n],path:d};for(var $ in r.children)e(t,r.children[$],n,!0)},d=function e(t,r,n,i,a){var o=t.getGrid(r.grid_id);if(n=c(n),r.tmpl){n.setAttribute("data-fr-grid-root",1),i?r.tmpl.setFirstNode(n).updateBindings():r.tmpl.setRoot(n).updateBindings(),o.set("$real_el",n);for(var s in r.children){var l=r.tmpl.bindings[s];l&&e(t,r.children[s],l,!1,!0)}}else{n&&!a&&(o.set("$real_el",n),n.setAttribute("data-fr-grid-root",1));for(var u in n.children)n.children.hasOwnProperty(u)&&r.children[u]&&e(t,r.children[u],n.children[u],!0,!a)}},v=function(e,t,r){var n=u(e,t.id,"$template"),i=p(e,n);r.innerHTML=i,d(e,n,r)},_=function(e,t){return e.getGrid(e.getGrid(t).parent)},y=function(e,t){return o[e.id][t]},m=function(e,t){return e.bindings[t]},g=function(e){n.innerHTML=e;var t=n.children;return t[1]&&console.error("Template should have only one root node,",t,e),t[0]};t.exports={eachGridMixin:{"$ozenfant.writer":[function(e,t,r){var n=i(e,2),a=n[0],l=n[1];if("$"!==a[0]&&t&&r&&o[r]&&a.indexOf("/")===-1){var c=!!o[r]&&o[r][t];if(!c){if(!s[r])return;var u=s[r][t],f=u.path+"/"+a;return void u.template.set(f,l)}c.set(a,l)}},"*","-$path","-$app_id"],$html_skeleton_changes:["$real_el"],"$ozenfant.remover":[function(e,t,r){var n=o[r][t];n&&n.root&&n.root.remove(),delete o[r][t]},"$remove","-$path","-$app_id"]},onBranchCreated:function(e,t,r,i){var s=e.getGrid(t);if(!i){if(!s.cell_values.$el)return;var l=c(s.cell_values.$el);n=document.createElement("div"),n.style.display="none",n.setAttribute("id","ozenfant-container-hidden"),document.getElementsByTagName("body")[0].appendChild(n),v(e,s,l)}if(a[e.id]&&a[e.id][i]){var f=e.getGrid(i).path,h=o[e.id][f];if(h){var l=h.bindings[s.name];if(!l)return void console.error("No binding found for",s.name,"in path",f);v(e,s,l)}else{var b=y(e,_(e,i).path),k=m(b,e.getGrid(i).name);if(!k)return void console.log("parent binding is absent!",_(e,i).path);var x=u(e,t,"$template"),w=p(e,x),l=g(w);k.appendChild(l),d(e,x,l,!0)}}}}},{"../utils":13}],11:[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var i=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(e,t){if(e){var r=new Ozenfant(e),n={};for(var i in t)t[i]instanceof Object||(n[i]=t[i]);return r}},o=function(e,t){if(t){var r=i(e,2),a=r[0],o=r[1];unusual_cell(a)||o instanceof Object||t.set.apply(t,n(e))}};t.exports={eachHashMixin:{$ozenfant_el:[function(e,t){var r;return e instanceof Function&&(r=e(t)),!!r&&$(r)},"../$ozenfant.bindings_search","$name"],$list_el:[function(e,t,r){if(null!==e&&void 0!==e&&r){var n=r[e];return get_by_selector(n,t,!0)}},"$name","../$real_el","../$list_template_writer.index_map"],$real_el:["firstTrueCb",function(e){return e&&e.length},"$el","$list_el","$ozenfant_el"],$ozenfant_template2:[a,"$template","-$real_values"],$ozenfant:["nested",function(e,t,r,n){if(t&&is_def(r)){var i={};for(var a in n)n[a]instanceof Object||(i[a]=n[a]);r&&t.render(r.get(0),i),e("bindings_search",function(e){return!!t.bindings&&t.bindings[e]}),e("html",t)}},["html","bindings_search"],"$ozenfant_template2","$real_el","-$real_values"],$ozenfant_writer:[o,"*","-$ozenfant_template2"],$ozenfant_first_render:[function(e,t,r){},"$inited","-$ozenfant_something","-$real_el"],$html_skeleton_changes:["$ozenfant.html"],$ozenfant_remove:[function(e,t){t&&t.html("")},"$remove","-$real_el"]}}},{}],12:[function(e,t,r){"use strict";var n=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=e("../utils"),a=function(e){var t={};return Firera.is_def(e)&&(e=i.raw(e))?(e.querySelectorAll("[data-fr]").forEach(function(e,r){var n=e.getAttribute("data-fr-name");n||(n=e.getAttribute("data-fr")),t[n]=e}),t):t},o=function(){var e={};return function(t,r){if("*"===t)e[r[0]]=r[1];else for(var n in e)r&&r[n]&&r[n].html(e[n])}};t.exports={eachGridMixin:{$el:["closure",function(){return function(e,t){return t?t[e]:null}},"$name","../$htmlbindings"],$real_el:["firstDefined","$el"],$html_template:["skipIf",function(e,t){var r=n(e,1),i=r[0],a=n(t,1),o=a[0];return!Firera.is_def(i)||!Firera.is_def(o)||i!==o},function(e){e=i.raw(e);var t="";return Firera.is_def(e)&&(t=e?e.innerHTML.trim():""),t},"$real_el"],$template_writer:[function(e,t,r,n,a){if(a=i.raw(a),Firera.is_def(e)&&Firera.is_def(a)&&a)return a.innerHTML=e,!0;if(!t&&Firera.is_def(a)&&n&&!r&&a){var o=n.map(function(e){return"<div>"+e+':<div data-fr="'+e+'"></div></div>'}).join(" ");a.innerHTML=o}},"$template","$html_template","$no_auto_template","-$real_keys","-$real_el"],$html_skeleton_changes:[i.id,"$template_writer"],$htmlbindings:[a,"-$real_el","$template_writer"],$writer:["closureFunnel",o,"$htmlbindings","*"]}}},{"../utils":13}],13:[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var i={},a=(i.always=function(e){return function(){return e}},i.init_if_empty=function(e){for(var t=1;;t+=2){var r=arguments[t],n=arguments[t+1];if(!r)break;void 0===e[r]&&(e[r]=n),e=e[r]}return e}),o=(i.throttle=function(e,t){var r=!1,n=!1;return function(){r?n=!0:(e(),r=!0,setTimeout(function(){r=!1,n&&(e(),n=!1)},t))}},i.log=function(){},i.group_by=function(e,t){var r={},n=!0,i=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;a(r,t instanceof Function?t(c):c[t],[]).push(c)}}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}return r},i.frozen=function(e){return JSON.parse(JSON.stringify(e))},i.id=function(e){return e},i.ids=function(){return arguments},i.raw=function(e){return e instanceof Node||!e?e:e[0]},i.arr_remove=function(e,t){var r=e.indexOf(t);r!==-1&&e.splice(r,1)},i.sh_copy=function(e){var t=e instanceof Array?[]:{};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},i.arr_different=function(e,t,r){for(var n in e)void 0===t[n]&&r(n)},i.arr_common=function(e,t,r){for(var n in e)void 0!==t[n]&&r(n)},i.arrDeltas=function(e,t){var r=o(t,e),n=o(e,t),i=l.mapFilter(t,function(t,r){if(e[r]!==t&&void 0!==e[r])return r}),a=[].concat(r.map(function(e){return["add",e,t[e]]}),n.map(function(e){return["remove",e]}),i.map(function(e){return["change",e,t[e]]}));return a},i.arr_fix_keys=function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;void 0!==s&&t.push(s)}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return t},i.arr_diff=function(e,t){var r=[];for(var n in e)t[n]||r.push(n);return r}),s=(i.second=function(e,t){return t},i.path_cellname=function(e){return e.split("/").pop()},i.is_special=function(e){return e.indexOf("/")!==-1||e.indexOf("|")!==-1||"*"===e||"$"===e[0]},{});window.bm={start:function(e,t,r){a(s,e,{},t,{sum:0},"ids",{},r,performance.now())},stop:function(e,t,r){s[e][t].ids[r]=performance.now()-s[e][t].ids[r]},report:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(e=console.log.bind(console));for(var t in s){var r=s[t],n=0;for(var i in r){var a=r[i];for(var o in a.ids){var l=a.ids[o];a.sum+=l}n+=a.sum}for(var c in r){var a=r[c];a.perc=100*(a.sum/n),console.log(c,"tag sum",a.sum,"branch sum",n,"%",a.perc)}}console.log(s)}};var l=(i.Obj={map:function(e,t,r){var n={},i=!!r&&r.except;for(var a in e)i&&i.indexOf(a)!==-1||(n[a]=t(e[a],a));return n},each:function(e,t){for(var r in e)if(t(e[r],r)===!1)break},join:function(e,t){var r=[];for(var n in e)r.push(e[n]);return r.join(t)},eachKey:function(e,t){for(var r in e)if(t(r)===!1)break}},i.Arr={mapFilter:function(e,t){var r=[];for(var n in e){var i;void 0!==(i=t(e[n],n))&&r.push(i)}return r},unique:function(e){for(var t=e.concat(),r=0;r<t.length;++r)for(var n=r+1;n<t.length;++n)t[r]===t[n]&&t.splice(n--,1);return t},realLength:function(e){return Object.keys(e).length}}),c=function(e){return e.toLowerCase()};i.split_camelcase=function(e){if(!e.match)return!1;var t=e.match(/^([a-z0-9]*)/),r=(e.match(/[A-Z][a-z0-9]*/g)||[]).map(c);return[t[1]].concat(n(r))};i.copy=function(e,t){for(var r in e)t.push(e[r])},i.kcopy=function(e,t){for(var r in e)t[r]=e[r]};t.exports=i},{}],14:[function(e,t,r){"use strict";var n=[" ","\t","\n"],i=function(e){return e[0]},a=function(e){return e.slice(1)},o=function e(t,r){if(r instanceof Array){if(1!==r.length){var n=[];for(var i in r)n.push(e(t,r[i]));return n}r=r[0]}if(!r)return void console.warn("oops",t,r);var a=r.type,o=r.children,s=t[a];if(!s)return void console.error("No token semantic description",a,r);if(s.type)switch(s.type){case"door":var l=s.ret?o[s.ret-1]:o;return e(t,l);case"chars":return{chars:r.chars}}return s.func?s.func(r,e.bind(null,t)):void 0},s=function(e,t){var r=function e(t,r){if(t.children)for(var n in t.children)if(t.children[n].type){var i={type:t.children[n].type,children:[]};t.children[n].chars&&(i.chars=t.children[n].chars),r.push(i),e(t.children[n],i.children)}else e(t.children[n],r)},n=[];return r({children:[e]},n),n[0]},l=function(e,t,r){var l=function(t){var r=e.empty_chars||n;return r.indexOf(t)!==-1},c=function t(r,n,o){var s,c={children:[]};if("string"==typeof r){c.type=r,e.syntax[r]||console.error("Token not found:",r);var u=e.syntax[r];if(void 0!==u.start)for(var f=!1,h=o;++o;){var p=n[o-1];if(!l(p)){if(p!==u.start)return[!1,h];break}}if(u.children)s=u.children;else if(u.free_chars){var h=o;if(!u.end&&!u.regex)return console.warn("Could not parse free chars without end!"),[!1,o];for(var f=!1,d=0;++o;){var p=n[o-1];if(void 0===p)return o-h>1&&(c.chars=n.substr(h,o-h-1),[c,o-1]);if(!l(p)||f){if(u.end&&p===u.end)return c.chars=n.substr(h,o-h-1+d),[c,o];if(u.regex){var v=n.substr(h+d,o-h-d);!!p.match(u.regex),!!v.match(u.regex);if(!p||!v.match(u.regex))return f?(c.chars=n.substr(h+d,o-h-1-d),[c,o-1]):[!1,o-1-d]}f=!0}else++d}}else{if(u.str){var _=n.substr(o,u.str.length);return _===u.str?[c,o+u.str.length]:[!1,o]}console.warn("No chars and no tokens - what to do?",u)}}else s=r;if(!s)return c;var y=i(s),m=a(s);switch(y){case">":var g=o,b=!0,k=!1,x=void 0;try{for(var w,$=m[Symbol.iterator]();!(b=(w=$.next()).done);b=!0){var S=w.value;if("string"!=typeof S){var O,A=S instanceof Array?S:S.type,F=S.optional,C=S.multiple;for(A instanceof Array&&"string"==typeof A[A.length-1]&&(F=!0,C=!0);;){var j=t(A,n,g);if(O=j[0],g=j[1],!O){if(F)break;return[!1,g]}if(o=g,c.children.push(O),!C)break;if(void 0===n[g])break}}}}catch(e){k=!0,x=e}finally{try{!b&&$.return&&$.return()}finally{if(k)throw x}}break;case"|":var E=!0,L=!1,N=void 0;try{for(var T,P=m[Symbol.iterator]();!(E=(T=P.next()).done);E=!0){var S=T.value;if("string"!=typeof S){var O,A=S instanceof Array?S:S.type,j=t(A,n,o);if(O=j[0],g=j[1],O){c.children.push(O),o=g;break}}}}catch(e){L=!0,N=e}finally{try{!E&&P.return&&P.return()}finally{if(L)throw N}}if(!c.children.length)return[!1,o];break;default:console.error("Unknown children type:",y)}if(u&&u.end)for(var G=o;++G;){var p=n[G-1];if(!l(p)){p===u.end&&(o=G);break}}return[c,o]},u=c("root_token",t,0);u=s(u[0]);var f=o(e.semantics,u);return{syntax:u,semantics:f}};t.exports={get_parser:function(e){return l.bind(null,e)},dump:function(e){var t=function e(t,r){if(t){var n=[];if(t.type&&n.push("Type: "+t.type),t.chars&&n.push("Str: "+t.chars),t.children){var i=[];for(var a in t.children)i.push(e(t.children[a],r+1));n.push("<div>"+i.join("\t")+"</div>")}return"<div>"+n.join("<br>")+"</div>"}};return t(e,0)}}},{}],15:[function(e,t,r){"use strict";var n=["classnames","tagname","str","quoted_str"],i=function(e){for(var t=1;;t+=2){var r=arguments[t],n=arguments[t+1];if(!r)break;void 0===e[r]&&(e[r]=n),e=e[r]}return e};t.exports={empty_chars:[" "],syntax:{root_token:{children:[">",{type:"item",multiple:!0,optional:!0}]},item:{children:[">",{type:"indent",optional:!0},["|",{type:"new_if",optional:!0},{type:"new_elseif",optional:!0},{type:"new_else",optional:!0},{type:"ternary_else"},[">",{type:"tagname",optional:!0},{type:"classnames",optional:!0},["|",{type:"quoted_str",optional:!0},{type:"variable",optional:!0},"optional"],{type:"bracket",optional:!0},{type:"loop",optional:!0},{type:"str",optional:!0}]],{type:"lineend"}]},comma:{regex:/^\,\s?$/,free_chars:!0},bracket:{start:"(",children:[">",{type:"assign",optional:!0},[">",{type:"comma"},{type:"assign"},"optional"]],end:")"},assign:{free_chars:!0,regex:/^[^\)^\,]*$/},quoted_str:{start:'"',end:'"',free_chars:!0},variable:{children:[">",{type:"varname"},{type:"ternary_if",optional:!0}]},ternary_if:{regex:/^\?$/,free_chars:!0},ternary_else:{regex:/^\:$/,free_chars:!0},new_if:{regex:/^\?\s?(.*)?$/,free_chars:!0},new_elseif:{regex:/^\*\s?(.*)?$/,free_chars:!0},new_else:{regex:/^\:$/,free_chars:!0},varname:{regex:/^\$[a-zA-Z0-9\-\_\.]*$/,free_chars:!0},indent:{regex:/^\t+$/,free_chars:!0},classnames:{regex:/^\.[\\.a-zA-Z0-9\-\_]*$/,free_chars:!0},tagname:{regex:/^[a-zA-Z0-9]+$/,free_chars:!0},loop:{regex:/\{([^\n]*)?$/,
free_chars:!0},str:{regex:/^[^\n]+$/,free_chars:!0},lineend:{regex:/\n$/,free_chars:!0}},semantics:{root_token:{func:function(e,t){var r={children:[]},n={"-1":r},i=t(e.children),a=0,o=[];for(var s in i){var l=i[s];if(l.tagname||l.classnames||l.quoted_str||l.variable||l.type){if("IF"===l.type&&o.push(l),"ELSE"===l.type){var c=o.pop();c.else_children=l}var u=l.level||0;u>a&&(a=u);var f=u-1;if(l.children=[],!n[f]){for(;f--&&!n[f];f>-2);if(!n[f])continue}for(var h=s;h>=0&&!(i[h].level<u);h--);var p=(n[f],i[h]);if(i[h]||(p=r),p.children.push(l),n[u]=l,u+1<a)for(var d=u+1,d=u+1;d<=a&&n[d];d++)delete n[d]}}return r.children}},item:{func:function(e,t){var r={},a=!0,o=!1,s=void 0;try{for(var l,c=e.children[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;switch(u.type){case"variable":r.varname=u.children[0].chars.slice(1),u.children[1]&&(r.type="IF");break;case"ternary_else":r.type="ELSE";break;case"new_if":var f=u.chars;r.varname=f.match(/\$([A-Za-z0-9\_]*)/)[1],r.expr=f.replace(/\?\s?/,"").replace("$"+r.varname,"ctx."+r.varname),r.type=u.type.toUpperCase();break;case"new_elseif":var f=u.chars;r.varname=f.match(/\$([^\s]*)/)[1],r.expr=f.replace(/\*\s?/,"").replace("$"+r.varname,"ctx."+r.varname),r.type=u.type.toUpperCase();break;case"new_else":r.type=u.type.toUpperCase();break;case"indent":r.level=u.chars.length;break;case"loop":r.loop=u.chars.match(/\{\$([^\}]*)\}/)[1];break;case"bracket":r.assignments=[];var h=!0,p=!1,d=void 0;try{for(var v,_=u.children[Symbol.iterator]();!(h=(v=_.next()).done);h=!0){var y=v.value;if("assign"===y.type){var m=y.chars.split(":"),g=m[0].trim(),b=m[1].trim();if("$"===b[0]){var k=1===b.length?g:b.substr(1);i(r,"attrStyleVars",[]).push([k,g])}r.assignments.push([g,b])}}}catch(e){p=!0,d=e}finally{try{!h&&_.return&&_.return()}finally{if(p)throw d}}}n.indexOf(u.type)!==-1&&(r[u.type]=u.chars)}}catch(e){o=!0,s=e}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}return r}},indent:{type:"chars"}}}},{}],16:[function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var i=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=e("./config"),o=e("../ooo_oo_o/parser").get_parser(a),s=function(e){for(var t=1;;t+=2){var r=arguments[t],n=arguments[t+1];if(!r)break;void 0===e[r]&&(e[r]=n),e=e[r]}return e},l=function(e){return e[e.length-1]},c=new Set(["href","src","style","target","id","class","rel","type","value"]),u=function(e){return c.has(e)||e.match(/^data\-/)},f=/\{\{([a-zA-Z0-9]*)\}\}/g,h=function(e){e instanceof Object?(this.struct=e,this.node_vars_paths=this.struct.node_vars_paths,this.text_vars_paths=this.struct.text_vars_paths,this.nodes_vars=this.struct.nodes_vars,this.var_types=this.struct.var_types,this.varname_pool=this.struct.varname_pool,this.if_else_tree=this.struct.if_else_tree,this.loop_pool=this.struct.loop_pool,this.str=this.struct.str):(this.str=e,this.struct=o(e+"\n"),this.node_vars_paths={},this.text_vars_paths={},this.nodes_vars={},this.var_types={},this.varname_pool={vars:{},var_aliases:{}},this.func=p(A({children:this.struct.semantics})),this.if_else_tree={str_to_func:{},var_funcs:{}},this.loop_pool={},this.get_vars({children:this.struct.semantics,root:!0},".",this.var_types,[],[])),this.state={},this.bindings={},this.getIfElseVarsIndex()},p=function(e,t,r){var n="'"+e+"'";t&&(n=t+" ? "+n+" : false");var i="ctx";if(r)for(var a=1;a<=r;a++)i+=", __loopvar"+a;var o="var res = []; var res2 = []; res.push("+n+'); return res.join("");';return new Function(i,o)};h.prepare=function(e){var t=Object.assign(Object.create(h.prototype,{}),o(e+"\n"));return t.node_vars_paths={},t.text_vars_paths={},t.nodes_vars={},t.var_types={},t.varname_pool={vars:{},var_aliases:{}},t.func=p(A({children:t.semantics})),t.if_else_tree={str_to_func:{},var_funcs:{}},t.loop_pool={},t.str=e,t.get_vars({children:t.semantics,root:!0},".",t.var_types,[],[]),t};var d=function(e){var t=e.varname;return t.length||(e.classnames?t=e.classnames.substr(1).split(".").pop():console.warn("Incorrect statement: variable without name and default class!")),t},v=function(e){return new Array(e+2).join(".")},_=function(e){var t=0;for(var r in e)"."===e[r]&&++t;return t-1},y="ololo@!@!#_",m=function(e,t,r,n,i,a){var o=e;if(t.vars[e]){s(t.var_aliases,e,[]);var c=y+e+"_"+t.var_aliases[e].length;t.var_aliases[e].push(c),e=c}else t.vars[e]=!0;var u=!!r.length&&"("+r.join(") && (")+")";if(u&&(n.str_to_func[u]?n.var_funcs[e]=n.str_to_func[u]:n.var_funcs[e]=n.str_to_func[u]=new Function("ctx","return "+u)),i.length){var f=a[i[i.length-1]];if(0!==o.indexOf(v(f.level)))for(var h=f,p=_(e);;){if("root"===h){s(t,"loop_var_links",{},o,{},e,f);break}if(h.level==p){var d=o.indexOf(".")!==-1?l(o.split(".")):o;s(h,"subordinary_loop_vars",{},d,f);break}if(h=h.parent_loop,"root"===h)break;h||(h="root")}s(f,"vars",{}),f.vars[e]=!0}return e},g=function(e){return["NEW_ELSE","NEW_ELSEIF","NEW_IF"].indexOf(e.type)!==-1},b=function(e){return e.partial_func?e.partial_func:e.root?"USE_ROOT_FUNC":void 0},k=function(e,t,r,n){var i={parent_loop:n,name:e,level:t};return r[e]=i,i},x=function(e){return e.replace("./*[1]",".")};h.prototype.register_path=function(e,t,r,n){n&&(s(n,"paths",{}),r=n.paths);var i=!1;if(t.indexOf("_{}_")!==-1){var a=t.split("_{}_");i=!0,t=a[a.length-1]}0!==t.indexOf("./*[1]")&&!i&&t.length?console.error("Template should have only one root node! Given",t.indexOf("./*[1]"),t,this.str):t=x(t),r[e]=t},h.prototype.get_vars=function(e,t,r,a,o,s){var l,c=this,h=this.node_vars_paths,p=this.text_vars_paths,v=this.nodes_vars;if(o.length&&(l=this.loop_pool[o[o.length-1]]),e.children){var _=0,y=0,w={};for(var $ in e.children){var S=e.children[$],O=t;if(g(S)||(S.tagname||S.classnames?++y:++_,O=s?t+"/_{}_":t+"/*["+(Number($)+1-_)+"]"),!S.type||"NEW_IF"!==S.type&&"NEW_ELSEIF"!==S.type&&"NEW_ELSE"!==S.type){if(void 0!==S.varname){var A=m(d(S),this.varname_pool,a,this.if_else_tree,o,this.loop_pool);this.register_path(A,O,h,l)}if(S.attrStyleVars){var F=!0,C=!1,j=void 0;try{for(var E,L=S.attrStyleVars[Symbol.iterator]();!(F=(E=L.next()).done);F=!0){var N=i(E.value,2),T=N[0],P=N[1];T=m(T,this.varname_pool,a,this.if_else_tree,o,this.loop_pool),this.register_path(T,O,h,l);var G=u(P)?"ATTR":"STYLE";r[T]={type:G,name:P}}}catch(e){C=!0,j=e}finally{try{!F&&L.return&&L.return()}finally{if(C)throw j}}this.get_vars(S,O,r,[].concat(n(a)),o)}S.quoted_str&&S.quoted_str.replace(f,function(e,r){var n=x(t+"/text()["+(Number($)+1-y)+"]");A=m(r,c.varname_pool,a,c.if_else_tree,o,c.loop_pool),v[n]||(v[n]=S.quoted_str),p[A]=n});var M=[].concat(n(o));if(S.loop){var I=m(S.loop,this.varname_pool,a,this.if_else_tree,o,this.loop_pool),q=k(I,o.length,this.loop_pool,l);this.register_path(I,O,h,l),r[I]={type:"LOOP",func:b(S),loop:q},M.push(I)}this.get_vars(S,O,r,[].concat(n(a)),M,!!S.loop)}else{if("NEW_IF"===S.type){var A=m(d(S),this.varname_pool,a,this.if_else_tree,o,this.loop_pool);w[A]=!0,this.register_path(A,O,h,l),r[A]=b(e);var z=[].concat(n(a));z.push(S.expr),this.get_vars(S,O,r,z,o);continue}if("NEW_ELSEIF"===S.type||"NEW_ELSE"===S.type){var A=d(S);w[A]||m(A,this.varname_pool,a,this.if_else_tree,o,this.loop_pool),r[A]=b(e),this.register_path(A,O,h,l);var z=[].concat(n(a));z.push(S.real_expr),this.get_vars(S,O,r,z,o);continue}this.get_vars(S,O,r,a,o)}}}};var w=new Set(["text","submit","checkbox","radio"]),$=function(e){return"' + ("+e+" || '') + '"},S=function(e,t,r,n,i){var a=[],o=!0,s=!1,l=void 0;try{for(var c,u=e[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var f=c.value;a.push(A(f,t,r,n,i))}}catch(e){s=!0,l=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw l}}return a.join("")},O=function(e){var t=0;for(var r in e){if("."!==e[r])break;++t}var n;return t?(n=e.substr(t),n=n.length?"."+n:"",e="__loopvar"+t+n):(e=e.length?"."+e:"",e="ctx"+e),e},A=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;e.loop&&++a,e.parent=parent;var o,s=e.children,l=" ' + \n'"+new Array(e.level).join("\t"),c=[],h=[],v="",_=!1,y=!1,m=!0,b=!1,k=void 0;try{for(var x,A=s[Symbol.iterator]();!(m=(x=A.next()).done);m=!0){var F=x.value;if(g(F)){_=!0,y=[];break}}}catch(e){b=!0,k=e}finally{try{!m&&A.return&&A.return()}finally{if(b)throw k}}if(e.loop&&(_=!0),g(e))switch(e.type){case"NEW_IF":r[e.level]=[O(e.varname),e.expr,[]],c.push(l+"'); if("+e.expr+") { res.push('"),v=S(s,t,r,y,a),c.push(v),c.push("'); }\nres.push('");break;case"NEW_ELSEIF":var C=i(r[e.level],3),j=C[0],E=C[1],L=C[2];r[e.level][2].push(e.expr),e.real_expr=e.expr+" && !("+E+")",c.push(l+"'); if("+e.expr+" && !("+E+")) { res.push('"),v=S(s,t,r,y,a),c.push(v),c.push(l+"'); }\nres.push('");break;case"NEW_ELSE":var N=i(r[e.level],3),j=N[0],E=N[1],L=N[2];e.varname=j,e.real_expr="!("+E+(L.length?" || "+L.join(" || "):"")+")",c.push(l+"'); if(!("+E+(L.length?" || "+L.join(" || "):"")+")) { res.push('"),v=S(s,t,r,y,a),c.push(v),c.push(l+"'); }\nres.push('")}else if(e.tagname||e.classnames||!t){var T;if(e.tagname)w.has(e.tagname)?(e.assignments=e.assignments||[],e.assignments.push(["type",e.tagname]),T="input"):T=e.tagname;else switch(t){case"ol":case"ul":T="li";break;case"tr":T="td";break;default:T="div"}if(v=S(s,T,r,y,a),c.push(v),t){if(h.push(l+"<"+T),e.classnames&&e.classnames.length>1&&h.push(' class="'+e.classnames.substr(1).replace(/\./g," ")+'"'),e.assignments){var P=[],G=!0,M=!1,I=void 0;try{for(var q,z=e.assignments[Symbol.iterator]();!(G=(q=z.next()).done);G=!0){var V=q.value,H=i(V,2),B=H[0],R=H[1];if("$"===R[0]){var W=1===R.length?B:R.substr(1);W=O(W),R=$(W)}u(B)?h.push(" "+B+'="'+R+'"'):P.push(B+": "+R+";")}}catch(e){M=!0,I=e}finally{try{!G&&z.return&&z.return()}finally{if(M)throw I}}P.length&&h.push(' style="'+P.join("")+'"')}if(h.push(">"),void 0===e.varname||e.type)if(e.loop){var U=O(e.loop);h.push("'); \n\t\t\t\t\tfor(var ___k"+a+" in "+U+") { \n\t\t\t\t\t\tvar __loopvar"+a+" = "+U+"[___k"+a+"]; \n\t\t\t\t\t\tres.push('"+v+"'); \n\t\t\t\t\t} \n\t\t\t\t\tres.push('")}else h.push(c.join(" "));else{var B=O(d(e));s.length&&console.error('Node should have either variable or child nodes, both given. Node: "'+e.tagname+e.classnames+'", variable: "'+B+'"'),h.push(l+$(B))}h.push(l+"</"+T+">"),o=h.join("")}}else e.quoted_str&&(o=l+e.quoted_str.replace(f,function(e,t){return"' + ctx."+t+" + '"})),e.variable&&(o=l+e.variable);if(o=o||c.join(""),_)if(n){if(n.push(e),y){var Y=!0,Z=!1,K=void 0;try{for(var D,J=y[Symbol.iterator]();!(Y=(D=J.next()).done);Y=!0){var X=D.value;n.push(X)}}catch(e){Z=!0,K=e}finally{try{!Y&&J.return&&J.return()}finally{if(Z)throw K}}}}else if(e.partial_func=p(v,!1,a),y){var Q=!0,ee=!1,te=void 0;try{for(var re,ne=y[Symbol.iterator]();!(Q=(re=ne.next()).done);Q=!0){var ie=re.value;ie.partial_func=e.partial_func}}catch(e){ee=!0,te=e}finally{try{!Q&&ne.return&&ne.return()}finally{if(ee)throw te}}}return o},F=function(e){var t=0;for(var r in e){if("."!==e[r])break;++t}return e.substr(t)};h.prototype.toHTML=function(e){e?this.state=e:e={},this.struct.func||(this.struct.func=p(A({children:this.struct.semantics,root:!0})));var t=this.struct.func(e);return t},h.prototype.searchByPath=function(e){return h.xpOne(e,this.root)},h.prototype.getIfElseVarsIndex=function(){this.if_else_vars={};for(var e in this.var_types)if(this.var_types[e]instanceof Object){for(var t in this.var_types[e].if_pool){this.var_types[e].if_pool[t];s(this.if_else_vars,t,{},e,!0)}for(var t in this.var_types[e].else_pool){this.var_types[e].if_pool[t];s(this.if_else_vars,t,{},e,!1)}for(var t in this.var_types[e].my_pool){var r=(this.var_types[e].my_pool[t],this.var_types[e].struct.real_expr||this.var_types[e].struct.expr);s(this.if_else_vars,t,{},e,r)}}},h.prototype.updateBindings=function(){this.bindings={};for(var e in this.node_vars_paths){if(this.if_else_vars[e]){var t=!1;for(var r in this.if_else_vars[e]){var n=this.if_else_vars[e][r],i=this.state[r];if(!(n&&i||!n&&!i)){t=!0;break}}if(t)continue}this.bindings[e]=this.searchByPath(this.node_vars_paths[e]),this.bindings[e]||console.warn("No node found for var",e,"in path:",this.node_vars_paths[e],"in context",this.root,", context",this.state)}for(var a in this.text_vars_paths)this.bindings[a]=this.searchByPath(this.text_vars_paths[a]),this.bindings[a]||console.warn("No node found for path:",this.text_vars_paths[a],"in context",this.root)},h.prototype.render=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&(this.state=JSON.parse(JSON.stringify(t))),e.innerHTML=this.toHTML(this.state),this.setRoot(e),this.updateBindings()},h.prototype.getTokenStruct=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=!e;e||(e=this.struct.syntax);var n=[new Array(t).join("\t")+e.type];if(e.children){var i=!0,a=!1,o=void 0;try{for(var s,l=e.children[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;n.push(this.getTokenStruct(c,t+1))}}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}}return(r?"\n":"")+n.join("\n")},h.prototype.getHTML=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e&&(this.state=e),this.toHTML(this.state)},h.prototype.setFirstNode=function(e){return this.root=e,this},h.prototype.setRoot=function(e){return this.root=e.children[0],this},h.prototype._setVarVal=function(e,t,r){if(this.if_else_vars[e])for(var n in this.if_else_vars[e]){var i=this.if_else_vars[e][n]?this.state[n]:!this.state[n];if(!i)return}t instanceof Object||(r.textContent=t)},h.prototype._setValByPath=function(e,t,r){document.evaluate(e,r,null,XPathResult.ANY_TYPE,null).iterateNext().innerHTML=t},h.prototype.updateLoopVals=function(e,t,r,n){var i=this.loop_pool[e],a=new Array(i.level+2).join(".");for(var o in t)if(t[o]!==r[o]){var s=a+o;i.paths[s]&&this.set(s,t[o],i,n,r[o])}},h.prototype.removeLoopItem=function(e,t){e.children[t].remove()},h.prototype.addLoopItems=function(e,t,r,n,i){for(var a=[],o=this.var_types[e].func,s=t;s<=r;++s)a.push(o(this.state,n[s]));i.insertAdjacentHTML("beforeend",a.join(""))},h.prototype.setLoop=function(e,t,r,n){for(var i in t){if(!r[i]){this.addLoopItems(e,i,t.length-1,t,n);break}this.updateLoopVals(e,t[i],r[i],n.children[i])}if(++i,r[i])for(;r[i];i++)this.removeLoopItem(n,i)},h.prototype.eachLoopBinding=function(e,t){var r,n=e.parent_loop;if(n)return void this.eachLoopBinding(n,function(i,a){var o=n.paths[e.name];r=h.xpOne(o,i),r||console.error("Cannot find bindings",i,o);var s=_(e.name),l=a[s][F(e.name)];for(var c in r.children)if(Number(c)==c){var u=r.children[c];t(u,a.concat(l[c]),c)}});var i=this.state[e.name];r=this.bindings[e.name];for(var a in r.children)if(Number(a)==a){var o=r.children[a];t(o,[i[a]],a)}},h.prototype.rec_set=function(e,t,r,n,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.split("/"),c=s[0].match(/([^\[]*)\[([^\]]*)\]/);if(!c){var u=new Array(o+1).join(".")+s[0],f=t.paths||t.node_vars_paths,p=h.xpOne(f[u],e);return a=a[F(u)],void(this.loop_pool[u]?this.setLoop(u,n,a,p):this.__set(u,n,a,p))}var d=new Array(o+1).join(".")+c[1],v=c[2];a=a[F(d)][v];var _=this.loop_pool[d],y=t===this?this.node_vars_paths:t.paths,m=h.xpOne(y[d],e),g=m.children[v],b=s.slice(1);if(b.length){var k=l(i)[d][v];this.rec_set(g,_,b.join("/"),n,i.concat(k),a,++o)}else{var k=l(i)[c[1]][v];k&&this.updateLoopVals(d,n,k,g)}},h.prototype.__set=function(e,t,r,i,a,o){var s=this;if(this.nodes_vars[this.text_vars_paths[e]]){var l=this.nodes_vars[this.text_vars_paths[e]],c=l.replace(f,function(e,t){return s.state[t]});this._setVarVal(e,c,i),i.innerHTML=c}else if(this.var_types[e])switch(this.var_types[e].type){case"ATTR":i.setAttribute(this.var_types[e].name,t);break;case"STYLE":i.style[this.var_types[e].name]=t;break;case"LOOP":this.setLoop(e,t,r,i);break;default:var u;"USE_ROOT_FUNC"===this.var_types[e]&&(u=this.struct.func),this.var_types[e]instanceof Function&&(u=this.var_types[e]);var h=[this.state];a&&(h=[this.state].concat(n(o)));var p=u.apply(null,h);i.innerHTML=p,this.updateBindings()}else this._setVarVal(e,t,i)},h.prototype.set=function(e,t,r,n,i,a,o){var s,l=this;if(e.indexOf("/")!==-1)return"/"===e[0]&&(e=e.substr(1)),void this.rec_set(this.root,this,e,t,[this.state],this.state);if(this.state[e]!==t||a){if(t instanceof Object)try{t=JSON.parse(JSON.stringify(t))}catch(e){}var c=r?i:this.state[e];if(a||"."===e[0]||(this.state[e]=t),this.varname_pool.loop_var_links&&this.varname_pool.loop_var_links[e]&&!r)for(var u in this.varname_pool.loop_var_links[e]){var f=this.varname_pool.loop_var_links[e][u];this.eachLoopBinding(f,function(e,t,r){l.set(u,t,f,e,c,!0,t)})}if(this.varname_pool.var_aliases[e]){var p=!0,d=!1,v=void 0;try{for(var _,y=this.varname_pool.var_aliases[e][Symbol.iterator]();!(p=(_=y.next()).done);p=!0){var m=_.value;this.set(m,t,r,n,i,!0)}}catch(e){d=!0,v=e}finally{try{!p&&y.return&&y.return()}finally{if(d)throw v}}}if(r)s=h.xpOne(r.paths[e],n);else{if(!this.bindings[e])return;s=this.bindings[e]}this.root&&(this.if_else_tree.var_funcs[e]&&!this.if_else_tree.var_funcs[e](this.state)||this.__set(e,t,c,s,r,o))}},h.xpOne=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return t!==document&&"/"===e[0]&&(e=e.substr(1)),document.evaluate(e,t,null,XPathResult.ANY_TYPE,null).iterateNext()},t.exports=h},{"../ooo_oo_o/parser":14,"./config":15}],17:[function(e,t,r){"use strict";var n=function(e,t){return t.split(e).map(function(e){return e.trim()})};t.exports={syntax:{root_token:{children:[">",{type:"set"}]},set:{children:[">",{type:"operator",optional:!0},{type:"item"},{type:"item_with_comma",multiple:!0,optional:!0}]},operator:{free_chars:!0,regex:/^([\>\|\&|\/])+$/},item_with_comma:{children:[">",{type:"comma"},{type:"item"}]},item:{children:["|",{type:"func",optional:!0},[">",["|",{type:"quoted_cellname"},{type:"cellname"},{type:"bracket_extended"}],{type:"cond",optional:!0},{type:"pipe",optional:!0},{type:"output",optional:!0},{type:"imperatives",optional:!0},{type:"quantifier",optional:!0}]]},bracket_extended:{children:[">",{type:"bracket"},{type:"pipe",optional:!0},{type:"output",optional:!0},{type:"imperatives",optional:!0},{type:"quantifier",optional:!0}]},bracket:{start:"(",children:[">",{type:"set"}],end:")"},quoted_cellname:{start:'"',end:'"',free_chars:!0},cellname:{free_chars:!0,regex:/^\s?([a-zA-Z0-9_\-])+\s?$/},output:{start:":",free_chars:!0,regex:/^([a-zA-Z0-9_\-])+$/},pipe:{start:"|",free_chars:!0,regex:/^([a-zA-Z0-9_\-])+$/},threedots:{str:"..."},cond:{start:"?",free_chars:!0,regex:/^([a-zA-Z0-9_\-])+$/},comma:{free_chars:!0,regex:/^[\,]+$/},func:{children:[">",{type:"cellname"},{type:"func_params"},{type:"threedots",optional:!0},{type:"pipe",optional:!0},{type:"output",optional:!0}]},func_params:{start:"(",free_chars:!0,end:")"},quantifier_char:{free_chars:!0,regex:/^[\*\+]+$/},quantifier_num:{free_chars:!0,start:"{",end:"}"},imperatives:{free_chars:!0,start:"[",end:"]"},quantifier:{children:["|",{type:"quantifier_char",optional:!0},{type:"quantifier_num",optional:!0}]}},semantics:{root_token:{type:"door"},bracket:{type:"door"},bracket_extended:{func:function(e,t){var r=t(e.children[0].children[0]),i=e.children.slice(1);if(!i.length)return r;if("|"!==r.subtype)return console.log("Useless quant or output - wrong revolver type",i),r;var a=!0,o=!1,s=void 0;try{for(var l,c=i[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;if("output"===u.type&&(r.output=t(u)),"pipe"===u.type&&(r.pipe=t(u).chars),"imperatives"===u.type){var f=n(",",u.chars).map(n.bind(null,"="));r.imperatives=f}if("quantifier"===u.type){var h={},p=t(u);switch(p.chars){case"*":h.min=0;break;case"+":h.min=1;break;default:if(p.chars.indexOf(",")!==-1){var d=p.chars.split(",");d[0]&&(h.min=Number(d[0])),d[1]&&(h.max=Number(d[1]))}else h.min=h.max=Number(p.chars)}r.quantifier=h}}}catch(e){o=!0,s=e}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}return r}},quantifier:{type:"door"},quantifier_char:{type:"chars"},quantifier_num:{type:"chars"},cond:{type:"chars"},pipe:{type:"chars"},set:{func:function(e,t){var r=e.children;return"operator"===r[0].type?{type:"revolver",subtype:r[0].chars,children:t(r.slice(1))}:r.length>1?{type:"revolver",subtype:">",children:t(r)}:t(r[0])}},output:{func:function(e){return e.chars}},func:{func:function(e,t){var r={name:e.children[0].chars,params:e.children[1].chars?e.children[1].chars:"",type:"func",subtype:"sync"},n=!0,i=!1,a=void 0;try{for(var o,s=e.children[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;"output"===l.type&&(r.output=t(l)),"pipe"===l.type&&(r.pipe=t(l).chars),"cond"===l.type&&(r.cond=t(l).chars),"threedots"===l.type&&(r.subtype="async")}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}},item:{func:function(e,t){var r={};if(1===e.children.length)switch(e.children[0].type){case"cellname":case"quoted_cellname":r.event={name:e.children[0].chars.trim(),type:"cell"};break;default:return t(e.children[0])}switch(e.children[0].type){case"cellname":case"quoted_cellname":r.event={name:e.children[0].chars.trim(),type:"cell"};break;default:r.event=t(e.children[0])}var i=!0,a=!1,o=void 0;try{for(var s,l=e.children[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;if("output"===c.type&&(r.output=t(c)),"quantifier"===c.type){var u={},f=t(c);switch(f.chars){case"*":u.min=0;break;case"+":u.min=1;break;default:if(f.chars.indexOf(",")!==-1){var h=f.chars.split(",");h[0]&&(u.min=Number(h[0])),h[1]&&(u.max=Number(h[1]))}else u.min=u.max=Number(f.chars)}r.quantifier=u}"pipe"===c.type&&(r.pipe=t(c).chars),"cond"===c.type&&(r.cond=t(c).chars),"imperatives"===c.type&&(r.imperatives=n(",",c.chars).map(n.bind(null,"=")))}}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return r}},item_with_comma:{type:"door",ret:2}}}},{}],18:[function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments[2];return{full_success:e,particular_success:t,value:r}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("../ooo_oo_o/parser"),s=e("./config"),l=o.get_parser(s),c={},u=function e(t,r){switch(t.event&&(t=t.event),t.type||console.warn("No type",t),t.type){case"revolver":switch(t.subtype){case"|":for(var n=0;n<t.children.length;n++){var i=t.children[n];i.event&&(i=i.event),e(t.children[n],r)}break;case">":var i=t.children[0];i.event&&(i=i.event),e(i,r)}break;case"cell":r.add(t.name)}return r},f=function(e){return e.full_success},h=function(e){return e.particular_success},p=function(e){return e.value},d=function(e){return!(!e||1===e.max)},v=function(e){return Number(e)==e},_=function(e,t,r){return void 0!==r&&(e[t]=r),e},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.struct=e,this.onOutput=t.onOutput||function(){},this.onSuccess=t.onSuccess,this.stateMutator=t.stateMutator?t.stateMutator:_,this.callbacks=r,this.state={},this.mirror={children:[]},this.refreshSubscriptions(),this.activate_needed_events()};y.prototype.getStruct=function(e){return this.struct},y.prototype.__runCallback=function(e,t){var r;return v(e)?(--e,r=this.callbacks[e]):r=this.callbacks[0][e],r instanceof Function?r(t):void console.error("Callback should be a function!")},y.prototype.set=function(e,t,r){r?(this.state[e]||(this.state[e]=[]),this.state[e].push(t)):this.state[e]=t,this.onOutput(e,t)},y.prototype.absorb=function(e,t,r,i){var o,s=this,l=function(o){var l=e.children[o];switch(l.event&&(l=l.event),l.type){case"cell":case"func":if(l.name===r){var c=e.children[o].cond;if(c){--c,s.callbacks[c]||console.error("No callback for cond:",c);var u=s.callbacks[c](s.state,i);if(!u)return n()}var f=t.children[o];f.counter=f.counter?f.counter+1:1;var h=e.children[o].pipe,p=e.children[o].imperatives,v=e.children[o].quantifier;if(v&&void 0!==v.max&&v.max<f.counter)return n();h&&(i=s.__runCallback(h,i));var _=e.children[o].output?e.children[o].output:r,y=d(v);return y?(s.state[_]||(s.state[_]=[]),s.state[_].push(i)):s.stateMutator(s.state,_,i),p&&p.forEach(function(e){var t=a(e,2),r=t[0],n=t[1];s.state[r]=s.state[n]}),v?f.counter>=v.min?n(!0,!0,i):n():n(!0,!0,i)}break;case"revolver":return t.children[o]||(t.children[o]={children:[]}),s.absorb(l,t.children[o],r,i)}return n()},c=function(e,t){s.onOutput(e,t)};e.subtype||(e=e.event);var u=!1;switch(e.subtype){case"|":for(var v in e.children)if(o=l(v),f(o)){var _=p(o);return e.children[v].output&&this.set(e.children[v].output,_),e.output&&this.set(e.output,_,d(e.quantifier)),n(!0,!0,i)}break;case"/":for(var y in e.children)if(void 0===t.successful_branch||t.successful_branch===y){if(o=l(y),h(o)&&(t.successful_branch=y),f(o))return e.children[y].output&&c(e.children[y].output,p(o)),n(!0,!0,i);if(t.successful_branch===y)break}break;case"&":t.count_all_counter=t.count_all_counter||0,t.count_all_each_event=t.count_all_each_event||{};for(var m in e.children)if(o=l(m),f(o)){if(u=!0,e.children[m].output&&c(e.children[m].output,p(o)),!t.count_all_each_event[m]&&(t.count_all_counter++,t.count_all_counter===e.children.length))return n(!0,!0,i);t.count_all_each_event[m]=!0}break;case">":for(var g=t.pos||0,b=g;e.children[b];b++){o=l(b);var k=t.children[b];if(k.counter=k.counter||0,f(o)){u=!0,void 0===t.counter&&(t.counter=0),++t.counter,e.children[b].output&&c(e.children[b].output,p(o));var x=g+1;if(!e.children[x])return n(!0,!0,i);(!e.children[b].quantifier||t.counter>e.children[b].quantifier.max)&&(g=b,++g,t.pos=g)}else if(e.children[b].quantifier&&0!==e.children[b].quantifier.min&&k.counter<e.children[b].quantifier.min)break;if(!e.children[b].quantifier||!d(e.children[b].quantifier))break;if(e.children[b].quantifier&&void 0!==e.children[b].quantifier.max&&t.counter<e.children[b].quantifier.max)break}break;default:console.log("Unknown revolver type:",e.subtype)}return n(!1,u)},y.prototype.refreshSubscriptions=function(){var e=new Set;this.subscriptions=u(this.getStruct(),e)},y.prototype.sleep=function(){this.mirror={children:[]},this.state={},this.sleeping=!0},y.prototype.awake=function(){this.sleeping=!1},y.prototype.activate_needed_events=function(){var e=this.get_active_cells_and_funcs(null,null,this.struct,this.mirror);this.needed_events=e[0];var t=function(e,t,r){this.drip(e.name,r)},r=!0,n=!1,a=void 0;try{for(var o,s=e[1][Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value,c=l.subtype;if(!l.mirror.run){if("sync"===c){var u=this.callbacks[0][l.name](this.state);t.call(this,l,!0,u)}else this.callbacks[0]||console.error('You should provide a callback object with "'+l.name+'" key!'),this.callbacks[0][l.name]instanceof Function||console.error("Expecting "+l.name+" to be a function, given",i(this.callbacks[0][l.name]),"instead!"),this.callbacks[0][l.name](this.state,t.bind(this,l));l.mirror.run=!0}}}catch(e){n=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}},y.prototype.get_active_cells_and_funcs=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Set,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Set;if("func"===r.type)return i.add(r.name),a.add(Object.assign({parent_mirror:t,mirror:n,parent:e},r)),[i,a];if("revolver"===r.type)switch(n.children||(n.children=[]),r.subtype){case">":if(n.pos=n.pos||0,!r.children[n.pos])return[i,a];var o=n.pos;do n.children[o]||(n.children[o]={children:[]}),this.get_active_cells_and_funcs(r,n,r.children[o],n.children[o],i,a),o++;while(r.children[o-1]&&r.children[o-1].quantifier&&!r.children[o-1].max||"func"===r.children[o-1].type);break;default:for(var s in r.children)n.children[s]||(n.children[s]={children:[]}),this.get_active_cells_and_funcs(r,n,r.children[s],n.children[s],i,a)}else switch(r.event||console.log("So what is it?",r),r.event.type){case"cell":i.add(r.event.name);break;case"revolver":this.get_active_cells_and_funcs(r,n,r.event,n,i,a)}return[i,a]},y.prototype.drip=function(e,t){if(!this.finished&&!this.sleeping&&this.needed_events.has(e)){var r=this.absorb(this.struct,this.mirror,e,t);this.activate_needed_events(),f(r)&&(this.finished=!0,this.mirror={children:[]},this.onSuccess&&this.onSuccess())}},t.exports={create:function(e,t){var r;r=c[e]?c[e]:c[e]=l(e);for(var n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];var o=new y(r.semantics,t,i);return o}}},{"../ooo_oo_o/parser":14,"./config":17}]},{},[6]);